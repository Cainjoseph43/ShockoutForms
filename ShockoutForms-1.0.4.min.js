"use strict";var Shockout;!function(e){var t=function(){function t(o,n,i){this.allowDelete=!1,this.allowPrint=!0,this.allowSave=!1,this.allowedExtensions=["txt","rtf","zip","pdf","doc","docx","jpg","gif","png","ppt","tif","pptx","csv","pub","msg"],this.attachmentMessage="An attachment is required.",this.confirmationUrl="/SitePages/Confirmation.aspx",this.debug=!1,this.dialogOpts={width:400,height:250,autoOpen:!1,show:{effect:"blind",duration:1e3},hide:{effect:"explode",duration:1e3}},this.editableFields=[],this.enableAttachments=!1,this.enableErrorLog=!0,this.errorLogListName="Error Log",this.errorLogSiteUrl="/",this.fieldNames=[],this.fileHandlerUrl="/_layouts/SPFormFileHandler.ashx",this.fileUploaders=[],this.includeUserProfiles=!0,this.includeWorkflowHistory=!0,this.requireAttachments=!1,this.siteUrl="",this.utils=e.Utils,this.viewModelIsBound=!1,this.workflowHistoryListName="Workflow History",this.currentUser={id:null,title:null,login:null,email:null,account:null,jobtitle:null,department:null,isAdmin:!1,groups:[]},this.itemId=null,this.listId=null,this.listItem=null,this.requireCheckout=!1,this.rootUrl=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),this.sourceUrl=null,this.version="1.0.1",this.queryStringId="formid",this.isSp2013=!1;var a,r=this;if(!(this instanceof t))throw a="You must declare an instance of this class with `new`.",alert(a),a;if(!n||!o){var s=["Missing required parameters:"];throw this.formId||s.push(" `formId`"),this.listName||s.push(" `listName`"),s=s.join(""),alert(s),s}if(this.formId=n,this.listName=o,this.listNameRest=e.Utils.toCamelCase(o),this.form="string"==typeof n?document.getElementById(n):n,!this.form)return void alert('An element with the ID "'+this.formId+'" was not found. Ensure the `formId` parameter in the constructor matches the ID attribute of the form element.');if(this.$form=$(this.form).addClass("sp-form"),$("form").attr({novalidate:"novalidate"}),this.sourceUrl=e.Utils.getQueryParam("source"),this.sourceUrl&&(this.sourceUrl=decodeURIComponent(this.sourceUrl)),i&&i.constructor===Object)for(var l in i)this[l]=i[l];t.DEBUG=this.debug,this.itemId=e.Utils.getIdFromHash();var d=e.Utils.getQueryParam(this.queryStringId);!this.itemId&&/\d/.test(d)&&(this.itemId=parseInt(d),e.Utils.setIdHash(this.itemId)),t.errorLogListName=this.errorLogListName,t.errorLogSiteUrl=this.errorLogSiteUrl,t.enableErrorLog=this.enableErrorLog,e.KoHandlers.bindKoHandlers(),this.viewModel=new e.ViewModel(this),this.viewModel.showUserProfiles(this.includeUserProfiles),r.$formStatus=$("<div>",{"class":"form-status"}).appendTo(r.$form),r.$createdInfo=r.$form.find(".created-info, [data-sp-created-info]"),r.$dialog=$("<div>",{id:"formdialog"}).appendTo(r.$form).dialog(r.dialogOpts),this.asyncFns=[r.getCurrentUserAsync,r.getUsersGroupsAsync,function(e){e.preRender&&e.preRender(e,e.viewModel),e.nextAsync(!0)},r.getListAsync,r.initForm,function(t,o){void 0===o&&(o=void 0),e.KoComponents.registerKoComponents(),ko.applyBindings(t.viewModel,t.form),t.viewModelIsBound=!0,t.nextAsync(!0)},r.getListItemAsync,r.getHistoryAsync,function(e){e.postRender&&e.postRender(e,e.viewModel),e.nextAsync(!0)},r.implementPermissions,r.finalize],this.nextAsync(!0,"Begin initialization...")}return t.prototype.getCurrentUser=function(){return this.currentUser},t.prototype.getDefaultViewUrl=function(){return this.defaultViewUrl},t.prototype.getDefailtMobileViewUrl=function(){return this.defailtMobileViewUrl},t.prototype.getForm=function(){return this.form},t.prototype.getItemId=function(){return this.itemId},t.prototype.setItemId=function(e){this.itemId=e},t.prototype.getListId=function(){return this.listId},t.prototype.getListItem=function(){return this.listItem},t.prototype.requiresCheckout=function(){return this.requireCheckout},t.prototype.getRootUrl=function(){return this.rootUrl},t.prototype.getSourceUrl=function(){return this.sourceUrl},t.prototype.getViewModel=function(){return this.viewModel},t.prototype.getVersion=function(){return this.version},t.prototype.nextAsync=function(e,t,o){void 0===e&&(e=!0),void 0===t&&(t=void 0),void 0===o&&(o=void 0);var n=this;return t&&this.updateStatus(t,e),e?0==this.asyncFns.length?void setTimeout(function(){n.$formStatus.hide()},2e3):void this.asyncFns.shift()(n,o):void 0},t.prototype.getCurrentUserAsync=function(t,o){function n(){e.SpSoap.getCurrentUser(function(e,o){return o?void t.nextAsync(!1,"Failed to retrieve your account. "+o):(t.currentUser=e,t.viewModel.currentUser(e),t.debug&&(console.info("This is SP 2010 REST services."),console.info("Current user is..."),console.info(t.viewModel.currentUser())),void t.nextAsync(!0,i))})}void 0===o&&(o=void 0),t.updateStatus("Retrieving your account...");var i="Retrieved your account.";t.debug&&console.info("Testing for SP 2013 API..."),e.SpApi15.getCurrentUser(function(e,o){404==o?n():(t.isSp2013=!0,t.currentUser=e,t.viewModel.currentUser(e),t.debug&&(console.info("This is the SP 2013 API."),console.info("Current user is..."),console.info(t.viewModel.currentUser())),t.nextAsync(!0,i))},!0)},t.prototype.getListAsync=function(t,o){function n(e){try{var o=$(e).find("List").first(),n=o.attr("ID");t.listId=n;var a=o.attr("RequireCheckout");t.requireCheckout=a?"true"==a.toLowerCase():!1;var s=o.attr("EnableAttachments");t.enableAttachments=s?"true"==s.toLowerCase():!1,t.defaultViewUrl=o.attr("DefaultViewUrl"),t.defailtMobileViewUrl=o.attr("MobileDefaultViewUrl"),$(e).find("Field").filter(function(e,t){return!!$(t).attr("DisplayName")&&"TRUE"!=$(t).attr("Hidden")&&!r.test($(t).attr("Name"))}).each(i),t.fieldNames.sort(),t.debug&&(console.info(t.listName+" list ID = "+t.listId),console.info("Field names are..."),console.info(t.fieldNames)),t.nextAsync(!0,"Initialized list settings.")}catch(l){if(t.debug)throw l;var d="Failed to initialize list settings.";t.logError(d+" SPForm.getListAsync.setupList(): ",l),t.nextAsync(!1,d)}}function i(o,n){if(n)try{var i=$(n),r=i.attr("DisplayName"),s=i.attr("Type"),l=i.attr("Name"),d=i.attr("Format"),c=i.attr("Required")?"true"==i.attr("Required").toLowerCase():!1,u=i.attr("ReadOnly")?"true"==i.attr("ReadOnly").toLowerCase():!1,p=i.attr("Description"),h=t.viewModel,m=e.Utils.toCamelCase(r);if(m in t.viewModel)return;t.fieldNames.push(m);var f;i.find("> Default").each(function(e,t){var o=$.trim($(t).text());if(s)switch(s.toLowerCase()){case"boolean":o="0"==o?!1:!0;break;case"number":case"currency":o-=0;break;case"datetime":"[today]"==o&&(o=new Date)}f=o});var v=s&&/^multi/i.test(s)?ko.observableArray([]):ko.observable(f?f:"Boolean"==s?!1:null);v._metadata={koName:m,displayName:r||null,name:l||null,format:d||null,required:c||!1,readOnly:u||!1,description:p||null,type:s};for(var g in v._metadata)v["_"+g]=v._metadata[g];if(a.test(s)){var b=i.attr("FillInChoice");v._isFillInChoice=!!b&&"True"==b;var y=[],k=[];i.find("CHOICE").each(function(e,t){var o=$(t).text();y.push({value:$(t).text(),selected:!1}),k.push(o)}),v._choices=y,v._options=k,v._multiChoice=!!s&&"MultiChoice"==s,v._metadata.choices=y,v._metadata.options=k,v._metadata.multichoice=v._multiChoice}v._metadata.$parent=v,h[m]=v,t.debug&&console.info("Created KO object: "+m+", type: "+s+", default val: "+f)}catch(w){if(t.logError("Failed to setup KO object at SPForm.getListAsync.setupKoVar(): ",w),t.debug)throw w}}void 0===o&&(o=void 0);var a=/choice/i,r=/\b(FolderChildCount|ItemChildCount|MetaInfo|ContentType|Edit|Type|LinkTitleNoMenu|LinkTitle|LinkTitle2|Version|Attachments)\b/;e.SpSoap.getList(t.siteUrl,t.listName,function(e,o){if(o){var i="Failed to retrieve list data. "+o;return t.nextAsync(!1,"Failed to retrieve list data. "+o),void t.logError(i)}n(e)})},t.prototype.initForm=function(o,n){void 0===n&&(n=void 0);try{o.updateStatus("Initializing dynamic form features...");{o.viewModel}return e.Utils.indexOf(o.fieldNames,"IsSubmitted")>-1&&(o.allowSave=!0,e.ViewModel.isSubmittedKey="IsSubmitted",o.debug&&console.info("initFormAsync: IsSubmitted key: "+e.ViewModel.isSubmittedKey)),o.viewModel.allowSave(o.allowSave),o.viewModel.allowPrint(o.allowPrint),o.viewModel.allowDelete(o.allowDelete),o.$formAction=$(e.Templates.getFormAction()).appendTo(o.$form),o.enableAttachments&&o.setupAttachments(o),o.enableErrorLog&&e.SpApi.getListItems(o.errorLogListName,function(e,n){n&&(o.enableErrorLog=t.enableErrorLog=!1)},o.errorLogSiteUrl,null,"Title,Error","Modified",1,!1),o.$createdInfo.replaceWith(e.KoComponents.soCreatedModifiedTemplate),o.includeWorkflowHistory&&o.$form.append(e.KoComponents.soWorkflowHistoryTemplate),o.$form.find("[data-new-only]").before("<!-- ko ifnot: !!$root.Id() -->").after("<!-- /ko -->"),o.$form.find("[data-edit-only]").before("<!-- ko if: !!$root.Id() -->").after("<!-- /ko -->"),o.$form.find("[data-author-only]").before("<!-- ko if: !!$root.isAuthor() -->").after("<!-- /ko -->"),o.$form.find("[data-non-authors]").before("<!-- ko ifnot: !!$root.isAuthor() -->").after("<!-- /ko -->"),void o.nextAsync(!0,"Form initialized.")}catch(i){if(o.debug)throw i;return o.logError("Error in SPForm.initFormAsync(): ",i),void o.nextAsync(!1,"Failed to initialize form.")}},t.prototype.getListItemAsync=function(t,o){function n(e,o){return o?(/not found/i.test(o+"")&&t.showDialog("The form with ID "+t.itemId+" doesn't exist or it was deleted."),void t.nextAsync(!1,o)):(t.listItem=e,t.bindListItemValues(t),void t.nextAsync(!0,"Retrieved form data."))}if(void 0===o&&(o=void 0),!t.itemId)return void t.nextAsync(!0,"This is a New form.");t.updateStatus("Retrieving form values...");var i=(t.viewModel,[]);t.enableAttachments&&i.push("Attachments"),e.SpApi.getListItem(t.listName,t.itemId,n,t.siteUrl,!1,i.length>0?i.join(","):null)},t.prototype.getUsersGroupsAsync=function(t,o){function n(e,o){return o?void t.nextAsync(!1,"Failed to retrieve your groups. "+o):(t.currentUser.groups=e,t.debug&&(console.info("Retrieved current user's groups..."),console.info(t.currentUser.groups)),void t.nextAsync(!0,"Retrieved your groups."))}return void 0===o&&(o=void 0),0==t.$form.find("[data-sp-groups], [user-groups]").length||t.isSp2013?void t.nextAsync(!0):(t.updateStatus("Retrieving your groups..."),void(t.isSp2013?e.SpApi15.getUsersGroups(t.currentUser.id,n):e.SpSoap.getUsersGroups(t.currentUser.login,n)))},t.prototype.implementPermissions=function(e,t){void 0===t&&(t=void 0);try{e.updateStatus("Retrieving your permissions..."),e.$form.find("[data-sp-groups], [user-groups]").each(function(t,o){var n=$(o).attr("data-sp-groups");n||(n=$(o).attr("user-groups"));var i=e.currentUserIsMemberOfGroups(n);e.debug&&(console.info("element is restricted to groups..."),console.info(n)),i||$(o).remove()}),e.nextAsync(!0,"Retrieved your permissions.")}catch(o){if(e.debug)throw o;e.logError("Error in SPForm.implementPermissionsAsync() ",o),e.nextAsync(!0,"Failed to retrieve your permissions.")}},t.prototype.getHistoryAsync=function(t,o){function n(o,n){if(t.debug&&(console.info("Retrieved workflow history..."),console.info(o.length)),n||!o){var i="The "+t.workflowHistoryListName+' list may be full at <a href="{url}">{url}</a>. Failed to retrieve workflow history in method, getHistoryAsync().'.replace(/\{url\}/g,t.rootUrl+t.siteUrl+"/Lists/"+t.workflowHistoryListName.replace(/\s/g,"%20"));return t.logError(i),void t.nextAsync(!1,"Failed to retrieve workflow history. "+n)}t.viewModel.historyItems([]);for(var a=0;a<o.length;a++)t.viewModel.historyItems().push(new e.HistoryItem(o[a].Description,e.Utils.parseDate(o[a].DateOccurred)));t.viewModel.historyItems.valueHasMutated(),t.nextAsync(!0,"Retrieved workflow history.")}if(void 0===o&&(o=void 0),!t.itemId||!t.includeWorkflowHistory)return void t.nextAsync(!0);t.updateStatus("Retrieving workflow history...");var i="ListID eq '"+t.listId+"' and PrimaryItemID eq "+t.itemId,a="Description,DateOccurred",r="DateOccurred";e.SpApi.getListItems(t.workflowHistoryListName,n,t.siteUrl,i,a,r,25,!1)},t.prototype.bindListItemValues=function(t){void 0===t&&(t=void 0),t=t||this;try{if(!t.itemId)return;var o=t.listItem,n=t.viewModel,i=/(__metadata|ContentTypeID|ContentType|Owshiddenversion|Version|Attachments|Path)/,a=/(MultiChoice|User|Choice)/;t.itemId=o.Id,n.Id(o.Id);for(var r in t.viewModel)r in o&&"_type"in n[r]&&!i.test(r)&&!a.test(n[r]._type)&&n[r](null!=o[r]&&"DateTime"==n[r]._type?e.Utils.parseDate(o[r]):"MultiChoice"==n[r]._type&&"results"in o[r]?o[r].results:o[r]||null);t.enableAttachments&&(t.viewModel.attachments(o.Attachments.results),t.viewModel.attachments.valueHasMutated());var s=o.CreatedBy,l=o.ModifiedBy;o.CreatedBy.Picture=e.Utils.formatPictureUrl(o.CreatedBy.Picture),o.ModifiedBy.Picture=e.Utils.formatPictureUrl(o.ModifiedBy.Picture),o.CreatedBy.WorkEMail=o.CreatedBy.WorkEMail||o.CreatedBy.EMail||"",o.ModifiedBy.WorkEMail=o.ModifiedBy.WorkEMail||o.ModifiedBy.EMail||"",o.CreatedBy.JobTitle=o.CreatedBy.JobTitle||o.CreatedBy.Title||null,o.ModifiedBy.JobTitle=o.ModifiedBy.JobTitle||o.ModifiedBy.Title||null,o.CreatedBy.WorkPhone=o.CreatedBy.WorkPhone||s.MobileNumber||null,o.ModifiedBy.WorkPhone=o.ModifiedBy.WorkPhone||l.MobileNumber||null,o.CreatedBy.Office=o.CreatedBy.Office||null,o.ModifiedBy.Office=o.ModifiedBy.Office||null,n.CreatedBy(o.CreatedBy),n.ModifiedBy(o.ModifiedBy),n.Created(e.Utils.parseDate(o.Created)),n.Modified(e.Utils.parseDate(o.Modified)),$(t.fieldNames).filter(function(e,n){return t.viewModel[n]?"User"==t.viewModel[n]._type&&n+"Id"in o:!1}).each(function(e,i){t.getPersonById(parseInt(o[i+"Id"]),n[i])}),$(t.fieldNames).filter(function(e,n){return t.viewModel[n]?"Choice"==t.viewModel[n]._type&&n+"Value"in o:!1}).each(function(e,t){n[t](o[t+"Value"])}),$(t.fieldNames).filter(function(e,n){return!!t.viewModel[n]&&"MultiChoice"==t.viewModel[n]._type&&"__deferred"in o[n]}).each(function(i,a){e.SpApi.executeRestRequest(o[a].__deferred.uri,function(e){t.debug&&(console.info("Retrieved MultiChoice data for "+a+"..."),console.info(e));var o=[];$.each(e.d.results,function(e,t){o.push(t.Value)}),n[a](o)})}),$(t.fieldNames).filter(function(e,n){return!!t.viewModel[n]&&"UserMulti"==t.viewModel[n]._type&&"__deferred"in o[n]}).each(function(t,i){e.SpApi.executeRestRequest(o[i].__deferred.uri,function(e){var t=[];$.each(e.d.results,function(e,o){t.push(o.Id+";#"+o.Account)}),n[i](t)})})}catch(d){if(t.debug)throw d;t.logError("Failed to bind form values in SPForm.bindListItemValues(): ",d)}},t.prototype.deleteListItem=function(t,o,n){if(void 0===o&&(o=void 0),void 0===n&&(n=3e3),confirm("Are you sure you want to delete this form?")){var i=t.parent,a=i.listItem;e.SpApi.deleteListItem(a,function(e,t){return t?void(o&&o(e,t)):(i.showDialog("The form was deleted. You'll be redirected in "+n/1e3+" seconds."),o&&o(e),void setTimeout(function(){window.location.replace(null!=i.sourceUrl?i.sourceUrl:i.rootUrl)},n))})}},t.prototype.saveListItem=function(t,o,n,i){function a(n,a){var s;r.debug&&(console.log("Callback from saveListItem()..."),console.log(a),console.log(n));var c=$(n).find("ErrorText");return c&&""!=c.text()?void r.logError(c.text()):($(n).find("*").filter(function(){return e.Utils.isZrow(this)}).each(function(e,o){s=parseInt($(o).attr("ows_ID")),null==r.itemId&&(r.itemId=s,t.Id(s)),r.debug&&(console.info("Item ID returned..."),console.info(s))}),null==e.Utils.getIdFromHash()&&null!=r.itemId&&e.Utils.setIdHash(r.itemId),void(o?(r.showDialog("<p>Your form has been submitted. You will be redirected in "+l/1e3+" seconds.</p>","Form Submission Successful"),i&&i(r.itemId),r.debug?console.warn("DEBUG MODE: Would normally redirect user to confirmation page: "+r.confirmationUrl):setTimeout(function(){window.location.href=null!=r.sourceUrl?r.sourceUrl:r.confirmationUrl},l)):(r.showDialog(d,"The form has been saved.",l),r.getListItemAsync(r),i&&i(r.itemId),r.includeWorkflowHistory&&setTimeout(function(){r.getHistoryAsync(r)},5e3))))}void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===i&&(i=void 0);var r=t.parent,s=!(null!=r.itemId),l=3e3,d=n||"<p>Your form has been saved.</p>",c=[];try{var u=e.Utils.getEditableKoNames(r.$form);if($(u).each(function(e,t){r.pushEditableFieldName(t)}),r.editableFields.sort(),r.debug&&(console.info("Editable fields..."),console.info(r.editableFields)),o="undefined"==typeof o?!0:o,r.preSave){var p=r.preSave(r,r.viewModel,o);if("undefined"!=typeof p&&!p)return}if(o&&!r.formIsValid(t))return;var h=t[e.ViewModel.isSubmittedKey];"undefined"==typeof h||null!=h()&&0!=h()||c.push([e.ViewModel.isSubmittedKey,o?1:0]),$(r.editableFields).each(function(o,n){if("_metadata"in t[n]){var i=t[n](),a=t[n]._type||t[n]._metadata.type;a=a?a.toLowerCase():null,"undefined"!=typeof i&&n!=e.ViewModel.isSubmittedKey&&(null!=i&&i.constructor===Array?i.length>0&&(i=i.join(";#")+";#"):"datetime"==a&&null!=e.Utils.parseDate(i)?i=e.Utils.parseDate(i).toISOString():null!=i&&"note"==a&&(i="<![CDATA["+$("<div>").html(i).html()+"]]>"),i=null==i?"":i,c.push([t[n]._name,i]))}}),e.SpSoap.updateListItem(r.itemId,r.listName,c,s,r.siteUrl,a)}catch(m){if(r.debug)throw m;r.logError("Error in SpForm.saveListItem(): ",m)}},t.prototype.finalize=function(e){try{e.setupNavigation(e),e.setupDatePickers(e),e.setupBootstrapValidation(e),e.nextAsync(!0,"Finalized form controls.")}catch(t){if(e.debug)throw t;e.logError("Error in SpForm.finalize(): ",t),e.nextAsync(!1,"Failed to finalize form controls.")}},t.prototype.deleteAttachment=function(t){if(confirm("Are you sure you want to delete "+t.Name+"? This can't be undone.")){var o=e.ViewModel.parent,n=o.viewModel;e.SpApi.deleteAttachment(t,function(e,o){if(o)return void alert("Failed to delete attachment: "+o);var i=n.attachments;i.remove(t)})}},t.prototype.getAttachments=function(t,o){if(void 0===t&&(t=void 0),void 0===o&&(o=void 0),t=t||this,!t.listItem||!t.enableAttachments)return void(o&&o());var n=[];e.SpApi.executeRestRequest(t.listItem.__metadata.uri+"/Attachments",function(e){try{t.viewModel.attachments(e.d.results),t.viewModel.attachments.valueHasMutated(),o&&o(n)}catch(i){if(t.debug)throw i;t.showDialog("Failed to retrieve attachments in SpForm.getAttachments(): ",i)}})},t.prototype.log=function(e){this.debug&&console.log(e)},t.prototype.updateStatus=function(e,t){void 0===t&&(t=!0);var o=this;this.$formStatus.html(e).css("color",t?"#ff0":"$f00").show(),setTimeout(function(){o.$formStatus.hide()},2e3)},t.prototype.showDialog=function(e,t,o){void 0===t&&(t=void 0),void 0===o&&(o=void 0);var n=this;t=t||"Form Dialog",e=null==e.toString().match(/<\w>\w*/)?"<p>"+e+"</p>":e,n.$dialog.html(e).dialog("open"),o&&setTimeout(function(){n.$dialog.dialog("close")},o)},t.prototype.formIsValid=function(t,o){void 0===o&&(o=!1);var n=t.parent,i=[],a=0,r=0,s=[];try{return n.$form.find(".required, [required]").each(function(o,r){var s=e.Utils.observableNameFromControl(r,n.viewModel);if(s&&t[s]){var l=t[s]();if(null==l||0==$.trim(l+"").length){var d,c=$("label[for='"+s+"']");c&&(d=c.html()),d||(d=$(r).closest(".form-group").find("label:first").html()),d||(d=t[s]._displayName),d||$(r).parent().first().html(),e.Utils.indexOf(i,d)<0&&(i.push(d),a++)}}}),n.$form.find(".invalid").each(function(e,t){$(t).parent();s.push($(parent).first().html()),r++}),r>0&&i.push('<p class="warning">There are validation errors with the following fields. Please correct before saving.</p><p style="color:#f00;">'+s.join("<br />")+"</p>"),n.enableAttachments&&n.requireAttachments&&0==t.attachments().length&&(a++,i.push(n.attachmentMessage)),a>0?(n.showDialog('<p>The following fields are required or invalid:</p><div class="error">'+i.join("<br/>")+"</div>"),!1):!0}catch(l){if(n.debug)throw l;return n.logError("Form validation error at SPForm.formIsValid(): ",l),!1}},t.prototype.getPersonById=function(o,n){var i=this;o&&e.SpApi.getPersonById(o,function(o,a){if(a){var r="Error in SPForm.getPersonById: "+a;return e.Utils.logError(r,t.errorLogListName),void(i.debug&&console.warn(r))}var s=o.Id+";#"+o.Name;n(s),i.debug&&console.warn("Retrieved person by ID... "+s)})},t.prototype.pushEditableFieldName=function(t){return!t||e.Utils.indexOf(this.editableFields,t)>-1||null!=t.match(/^(_|\$)/)||e.Utils.indexOf(this.fieldNames,t)<0||this.viewModel[t]._readOnly?-1:this.editableFields.push(t)},t.prototype.logError=function(t,o,n){void 0===o&&(o=void 0),void 0===n&&(n=void 0),n=n||this;var i=[t];o&&i.push(o+""),i=i.join(i.length>0?"; ":""),n.enableErrorLog&&(e.Utils.logError(i,n.errorLogListName,n.rootUrl,n.debug),n.showDialog("<p>An error has occurred and the web administrator has been notified.</p><pre>"+i+"</pre>"))},t.prototype.setupAttachments=function(t){void 0===t&&(t=void 0),t=t||this;var o=(t.viewModel,0);if(!t.enableAttachments)return o;try{var n=e.Utils.formatSubsiteUrl(t.siteUrl),i=t.fileHandlerUrl.replace(/^\//,"");t.fileHandlerUrl=t.rootUrl+n+i,t.$form.find(".attachments, [data-sp-attachments]").each(function(n,i){var a="so-qq-fileuploader_"+n;$(i).replaceWith(e.Templates.getAttachmentsTemplate(a));var r=new e.FileUploaderSettings(t,a,t.allowedExtensions),s=new e.qq.FileUploader(r);t.fileUploaders.push(s),o++}),t.debug&&console.info("Attachments are enabled.")}catch(a){if(t.debug)throw a;t.logError("Error in SPForm.setupAttachments(): ",a)}return o},t.prototype.setupBootstrapValidation=function(t){void 0===t&&(t=void 0);var o=0;t=t||this;try{t.$form.find("[required], .required").each(function(n,i){var a=$(i).closest(".form-group"),r=a.attr("data-bind");if(!/has-error/.test(r)){var s=e.Utils.observableNameFromControl(i,t.viewModel),l="css:{ 'has-error': !!!"+s+"(), 'has-success has-feedback': !!"+s+"()}";if(r){var d=a.attr("data-bind");a.attr("data-bind",d+", "+l)}else a.attr("data-bind",l);a.append('<span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>'),o++}})}catch(n){if(t.debug)throw n;t.logError("Error in SPForm.setupBootstrapValidation(): ",n)}return o},t.prototype.setupNavigation=function(t){void 0===t&&(t=void 0);var t=t||this,o=0;try{var n=t.$form.find(".nav-section");if(0==n.length)return o;t.$form.prepend('<section class="no-print" id="TOP"><h4>Navigation</h4><div class="navigation-buttons"></div></section>'),t.$form.find("#workflowHistory, [data-workflow-history]").addClass("nav-section"),t.$form.find(".nav-section:visible").each(function(n,i){var a=$(i),r=a.find("> h4");if(0!=r.length){var s=r.text(),l=e.Utils.toCamelCase(s)+"Nav";a.before('<div style="height:1px;" id="'+l+'">&nbsp;</div>'),t.$form.find(".navigation-buttons").append('<a href="#'+l+'" class="btn btn-sm btn-info">'+s+"</a>"),o++}}),t.$form.append('<a href="#TOP" class="back-to-top"><span class="glyphicon glyphicon-chevron-up"></span></a>'),$("body").delegate("a[href*=#]:not([href=#])","click",function(){if(window.location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=$(this.hash);if(e=e.length?e:$("[name="+this.hash.slice(1)+"]"),e.length)return $("html,body").animate({scrollTop:e.offset().top-50},1e3),!1}})}catch(i){if(t.debug)throw i;t.logError("Error in SpForm.setupNavigation(): ",i)}return o},t.prototype.setupDatePickers=function(e){void 0===e&&(e=void 0),e=e||this;var t=e.$form.find("input.datepicker").datepicker();return e.debug&&console.info("Bound "+t.length+" jQueryUI datepickers."),t.length},t.prototype.currentUserIsMemberOfGroups=function(t){var o=[];if(e.Utils.isString(t))o=null!=t.match(/\,/)?t.split(","):[t];else{if(t.constructor!==Array)return!1;o=t}for(var n=0;n<o.length;n++){var i=o[n];i=null!=i.match(/\;#/)?i.split(";")[0]:i,i=e.Utils.trim(i);for(var a=0;a<this.currentUser.groups.length;a++){var r=this.currentUser.groups[a];if(i==r.name||parseInt(i)==r.id)return!0}}return!1},t.DEBUG=!1,t}();e.SPForm=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function e(t){this.Id=ko.observable(null),this.Created=ko.observable(null),this.CreatedBy=ko.observable(null),this.Modified=ko.observable(null),this.ModifiedBy=ko.observable(null),this.allowSave=ko.observable(!1),this.allowPrint=ko.observable(!1),this.allowDelete=ko.observable(!1),this.attachments=ko.observableArray(),this.historyItems=ko.observableArray(),this.showUserProfiles=ko.observable(!1);var o=this;this.parent=t,e.parent=t,this.isValid=ko.pureComputed(function(){return o.parent.formIsValid(o)}),this.deleteAttachment=t.deleteAttachment,this.currentUser=ko.observable(t.getCurrentUser()),this.attachments.getViewModel=function(){return o},this.attachments.getSpForm=function(){return o.parent}}return e.prototype.isAuthor=function(){return this.CreatedBy()?this.currentUser().id==this.CreatedBy().Id:!0},e.prototype.deleteItem=function(){this.parent.deleteListItem(this)},e.prototype.cancel=function(){var e=this.parent.getSourceUrl();window.location.href=e?e:this.parent.getRootUrl()},e.prototype.print=function(){window.print()},e.prototype.save=function(e){this.parent.saveListItem(e,!1)},e.prototype.submit=function(e){this.parent.saveListItem(e,!0)},e}();e.ViewModel=t}(Shockout||(Shockout={}));var Shockout;!function(e){function t(t){t.bindingHandlers.spHtmlEditor={init:function(t,o,n,i){function a(){i[r]($(this).html())}var r=e.Utils.observableNameFromControl(t);$(t).blur(a).change(a).keydown(a)},update:function(e,o){var n=t.utils.unwrapObservable(o())||"";e.innerHTML!==n&&(e.innerHTML=n)}},t.bindingHandlers.spPerson={init:function(o,n,i,a){function r(t,o){var n=$.trim($(t).val());return""==n?(o(null),void $(t).removeClass("valid").removeClass("invalid")):void(e.Utils.validateSpPerson(o())?($(t).val(o().split("#")[1]),$(t).addClass("valid").removeClass("invalid")):$(t).removeClass("valid").addClass("invalid"))}try{if("input"!=o.tagName.toLowerCase()||"hidden"==$(o).attr("type"))return;var s=(a.$data,n()),l=(t.unwrap(s),$(o).addClass("people-picker-control").attr("placeholder","Employee Account Name")),d=($(o).parent(),$("<div>",{"class":"sp-validation person"}));l.after(d);var c=$("<div>",{"class":"no-print",html:"<em>Enter the employee name. The auto-suggest menu will appear below the field. Select the account name.</em>"});d.after(c);var u=$("<button>",{html:'<span class="glyphicon glyphicon-user"></span>',"class":"btn btn-sm btn-default no-print",title:"Validate the employee account name."}).on("click",function(){return""==$.trim(l.val())?(l.removeClass("invalid").removeClass("valid"),!1):(e.Utils.validateSpPerson(s())?(d.text("Valid").removeClass("error"),l.removeClass("invalid").addClass("valid").show()):(d.text("Invalid").addClass("error").show(),l.addClass("invalid").removeClass("valid")),!1)}).insertAfter(l),p=($("<button>",{"class":"btn btn-sm btn-default reset",html:"Reset"}).on("click",function(){return s(null),!1}).insertAfter(u),{source:function(t,o){e.SpSoap.searchPrincipals(t.term,function(e){o($.map(e,function(e){return{label:e.DisplayName+" ("+e.Email+")",value:e.UserInfoID+";#"+e.AccountName}}))},10,"User")},minLength:3,select:function(e,t){s(t.item.value)}});$(o).autocomplete(p),$(o).on("focus",function(){$(this).removeClass("valid")}).on("blur",function(){r(this,s)}).on("mouseout",function(){r(this,s)})}catch(h){e.SPForm.DEBUG&&(console.info("Error in Knockout handler spPerson init()"),console.info(h))}},update:function(o,n,i,a){try{var r=(a.$data,n()),s=t.unwrap(r),l="";e.Utils.validateSpPerson(s)&&(l=s.split("#")[1],$(o).addClass("valid")),"value"in o?$(o).val(l):$(o).text(l)}catch(d){e.SPForm.DEBUG&&(console.info("Error in Knockout handler spPerson update()"),console.info(d))}}},t.bindingHandlers.spMoney={init:function(e,o,n,i,a){function r(){var e=this.value.toString().replace(/[^\d\.\-]/g,"");e=""==e?null:e-0,s(e)}if("input"==e.tagName.toLowerCase()&&"hidden"!=$(e).attr("type")){i=a.$data;{var s=o();t.unwrap(s)}$(e).on("blur",r).on("change",r)}},update:function(o,n,i,a,r){a=r.$data;var s=n(),l=t.unwrap(s);null!=l?0>l?$(o).addClass("negative"):$(o).removeClass("negative"):l=0;var d=e.Utils.formatMoney(l);e.Utils.updateKoField(o,d)}},t.bindingHandlers.spDecimal={init:function(e,o,n,i,a){function r(){var e=this.value.toString().replace(/[^\d\-\.]/g,"");e=""==e?null:e-0,s(e)}if("input"==e.tagName.toLowerCase()&&"hidden"!=$(e).attr("type")){i=a.$data;{var s=o();t.unwrap(s)}$(e).on("blur",r).on("change",r)}},update:function(o,n,i,a,r){a=r.$data;var s=n(),l=t.unwrap(s),d=i.get("precision")||2,c=e.Utils.toFixed(l,d);null!=l?0>l?$(o).addClass("negative"):$(o).removeClass("negative"):l=0,e.Utils.updateKoField(o,c)}},t.bindingHandlers.spNumber={init:function(e,o,n,i,a){function r(){var e=this.value.toString().replace(/[^\d\-]/g,"");e=""==e?null:e-0,s(e)}if("input"==e.tagName.toLowerCase()&&"hidden"!=$(e).attr("type")){i=a.$data;{var s=o();t.unwrap(s)}$(e).on("blur",r).on("change",r)}},update:function(o,n,i,a,r){a=r.$data;var s=n(),l=t.unwrap(s);l=null==l?0:l,l=l.constructor==String?l=l.replace(/\D/g)-0:l,e.Utils.updateKoField(o,l),s.constructor==Function&&s(l)}},t.bindingHandlers.spDate={after:["attr"],init:function(t,o){function n(){i(e.Utils.parseDate(this.value))}var i=o();"input"==t.tagName.toLowerCase()&&"hidden"!=$(t).attr("type")&&($(t).css("display","inline-block").addClass("datepicker med").attr("placeholder","MM/DD/YYYY").on("blur",n).on("change",n).after('<span class="glyphicon glyphicon-calendar"></span>'),$(t).datepicker({changeMonth:!0,changeYear:!0}))},update:function(o,n){var i=n(),a=e.Utils.parseDate(t.unwrap(i)),r="";a&&null!=a&&(r=e.Utils.dateToLocaleString(a)),"value"in o?$(o).val(r):$(o).text(r)}},t.bindingHandlers.spDateTime={after:["attr"],init:function(t,o){if("input"==t.tagName.toLowerCase()&&"hidden"!=$(t).attr("type"))try{var i=o(),a=new n(t,i);t.$$model=a}catch(r){if(e.SPForm.DEBUG)throw console.warn("Error in Knockout handler spDateTime init()..."),r}},update:function(o,i){try{{var a=i();e.Utils.parseDate(t.unwrap(a))}if("input"==o.tagName.toLowerCase()){var r=o.$$model;r&&r.constructor==n&&r.setDisplayValue(a)}else $(o).text(n.toString(a))}catch(s){if(e.SPForm.DEBUG)throw console.warn("Error in Knockout handler spDateTime update()...s"),s}}}}var o=function(){function e(){}return e.bindKoHandlers=function(){t(ko)},e}();e.KoHandlers=o;var n=function(){function t(t,o){function n(){i.setModelValue(o)}var i=this,a=ko.unwrap(o);this.$element=$(t),this.$parent=this.$element.parent(),e.Utils.isJsonDateTicks(a)&&o(e.Utils.parseJsonDate(a)),this.required=this.$element.hasClass("required")||null!=this.$element.attr("required"),this.$element.attr({placeholder:"MM/DD/YYYY",maxlength:10,"class":"datepicker med form-control"}).css("display","inline-block").on("change",n).datepicker({changeMonth:!0,changeYear:!0}),this.required&&this.$element.attr("required","");for(var r=[],s=1;12>=s;s++)r.push('<option value="'+s+'">'+(10>s?"0"+s:s)+"</option>");for(var l=[],s=0;60>s;s++)l.push('<option value="'+s+'">'+(10>s?"0"+s:s)+"</option>");var d='<span class="glyphicon glyphicon-calendar"></span>\n                <select class="form-control so-select-hours" style="margin-left:1em; max-width:5em; display:inline-block;">'+r.join("")+'</select>\n                <span> : </span>\n                <select class="form-control so-select-minutes" style="width:5em; display:inline-block;">'+l.join("")+'</select>\n                <select class="form-control so-select-tt" style="margin-left:1em; max-width:5em; display:inline-block;"><option value="AM">AM</option><option value="PM">PM</option></select>\n                <button class="btn btn-sm btn-default reset" style="margin-left:1em;">Reset</button>\n                <span class="error no-print" style="display:none;">Invalid Date-time</span>\n                <span class="so-datetime-display no-print" style="margin-left:1em;"></span>';this.$element.after(d),this.$display=this.$parent.find(".so-datetime-display"),this.$error=this.$parent.find(".error"),this.$hh=this.$parent.find(".so-select-hours").val("12").on("change",n),this.$mm=this.$parent.find(".so-select-minutes").val("0").on("change",n),this.$tt=this.$parent.find(".so-select-tt").val("AM").on("change",n),this.$reset=this.$parent.find(".btn.reset").on("click",function(){try{i.$element.val(""),i.$hh.val("12"),i.$mm.val("0"),i.$tt.val("AM"),i.$display.html(""),o(null)
}catch(e){console.warn(e)}return!1})}return t.prototype.setModelValue=function(t){try{if(!$.trim(this.$element.val()))return;var o=e.Utils.parseDate(this.$element.val()),n=parseInt(this.$hh.val()),i=parseInt(this.$mm.val()),a=this.$tt.val();"PM"==a&&12>n?n+=12:"AM"==a&&n>11&&(n-=12);var r=new Date;r.setUTCFullYear(o.getFullYear()),r.setUTCMonth(o.getMonth()),r.setUTCDate(o.getDate()),r.setUTCHours(n,i,0,0),t(r)}catch(s){if(e.SPForm.DEBUG)throw s}},t.prototype.setDisplayValue=function(t){try{var o=ko.unwrap(t);if(!o||o.constructor!=Date)return;var o=ko.unwrap(t),n=o.getUTCHours(),i=o.getUTCMinutes();this.$element.val(o.getUTCMonth()+1+"/"+o.getUTCDate()+"/"+o.getUTCFullYear()),n>12?(n-=12,this.$tt.val("PM")):0==n?(n=12,this.$tt.val("AM")):this.$tt.val(12==n?"PM":"AM"),this.$hh.val(n.toString()),this.$mm.val(i.toString()),this.$display.html(this.toString(t))}catch(a){if(e.SPForm.DEBUG)throw a}},t.prototype.toString=function(e){return t.toString(e)},t.toString=function(t){try{var o=ko.unwrap(t);if(null==o||o.constructor!=Date)return;var n=e.Utils.toDateTimeLocaleString(o),i=/\b\s\(\w+\s\w+\s\w+\)/i.exec(o.toString());return i&&(n+=" "+i[0].replace(/\b\w+/g,function(e){return e[0]}).replace(/\s/g,"")),n}catch(a){if(e.SPForm.DEBUG)throw a}return null},t}()}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function t(){}return t.registerKoComponents=function(){function o(e){if(!e)throw"params is undefined in so-static-field";var t=e.val||e.modelValue;if(!t)throw"Parameter `val` or `modelValue` for so-static-field is required!";this.modelValue=t,this.id=e.id||t._koName,this.label=e.label||t._displayName,this.description=e.description||t._description;var o=parseInt(e.labelColWidth||3),n=parseInt(e.fieldColWidth||12-(o-0));this.labelColWidth="col-sm-"+o,this.fieldColWidth="col-sm-"+n}function n(e){if(!e)throw"params is undefined in soFieldModel";var t=e.val||e.modelValue;if(!t)throw"Parameter `val` or `modelValue` for so-text-field is required!";this.modelValue=t,this.id=e.id||t._koName,this.name=e.name||t._koName||e.id,this.label=e.label=""==e.label?void 0:e.label||t._displayName,this.title=e.title,this.caption=e.caption,this.maxlength=e.maxlength||255,this.placeholder=e.placeholder||e.label||t._displayName,this.description="undefined"!=typeof e.description?null==e.description?void 0:e.description:t._description,this.valueUpdate=e.valueUpdate,this.editable=!!t._koName,this.koName=t._koName,this.options=e.options||t._options,this.required="function"==typeof e.required?e.required:ko.observable(!!e.required||!1),this.inline=e.inline||!1,this.multiline=e.multiline||!1;var o=parseInt(e.labelColWidth||3),n=parseInt(e.fieldColWidth||12-(o-0));this.labelColWidth="col-sm-"+o,this.fieldColWidth="col-sm-"+n,this.readOnly="function"==typeof e.readOnly?e.readOnly:ko.observable(!!e.readOnly||!1)}function i(e){if(!e)throw"params is undefined in soFieldModel";var t=this,o=e.val||e.modelValue;if(!o)throw"Parameter `val` or `modelValue` for so-text-field is required!";this.modelValue=o,this.placeholder="",this.id=e.id||o._koName,this.name=e.name||o._koName||e.id,this.label=e.label||o._displayName,this.title=e.title,this.required=e.required,this.description=e.description||o._description,this.editable=!!o._koName,this.koName=o._koName,this.person=ko.observable(null),this.readOnly="function"==typeof e.readOnly?e.readOnly:ko.observable(!!e.readOnly||!1),this.addPerson=function(e,o){null==t.modelValue()&&t.modelValue([]);var n=!1;return ko.utils.arrayForEach(t.modelValue(),function(e){e==t.person()&&(n=!0)}),n?this.shake(o):(t.modelValue().push(t.person()),t.modelValue.valueHasMutated(),t.person(null)),!1},this.removePerson=function(e){try{t.modelValue.remove(e)}catch(o){var n=t.modelValue().indexOf(e);n>-1&&(t.modelValue().splice(t.modelValue().indexOf(e),1),t.modelValue.valueHasMutated())}return!1},this.showRequiredText=ko.pureComputed(function(){return t.required?t.modelValue()?t.modelValue().length<1:!0:!1}),this.shake=function(e){var t=$("button[id="+e.currentTarget.id+"]"),o=3,n=5,i=200;t.css("position","relative");for(var a=1;o>=a;a++)t.removeClass("btn-success").addClass("btn-danger").animate({left:-1*n},i/o/4).animate({left:n},i/o/2).animate({left:0},i/o/4),setTimeout(function(){t.removeClass("btn-danger btn-warning").addClass("btn-success")},1e3)}}var a=function(){var e=0;return function(){return e++}}();ko.components.register("so-text-field",{viewModel:n,template:t.soTextFieldTemplate}),ko.components.register("so-html-field",{viewModel:n,template:t.soHtmlFieldTemplate}),ko.components.register("so-person-field",{viewModel:n,template:t.soTextFieldTemplate.replace(/data-bind="(value|text): modelValue/g,'data-bind="spPerson: modelValue')}),ko.components.register("so-date-field",{viewModel:n,template:t.soTextFieldTemplate.replace(/data-bind="(value|text): modelValue/g,'data-bind="spDate: modelValue')}),ko.components.register("so-datetime-field",{viewModel:n,template:t.soTextFieldTemplate.replace(/data-bind="(value|text): modelValue/g,'data-bind="spDateTime: modelValue')}),ko.components.register("so-money-field",{viewModel:n,template:t.soTextFieldTemplate.replace(/data-bind="(value|text): modelValue/g,'data-bind="spMoney: modelValue')}),ko.components.register("so-number-field",{viewModel:n,template:t.soTextFieldTemplate.replace(/data-bind="(value|text): modelValue/g,'data-bind="spNumber: modelValue')}),ko.components.register("so-decimal-field",{viewModel:n,template:t.soTextFieldTemplate.replace(/data-bind="(value|text): modelValue/g,'data-bind="spDecimal: modelValue')}),ko.components.register("so-checkbox-field",{viewModel:n,template:t.soCheckboxFieldTemplate}),ko.components.register("so-select-field",{viewModel:n,template:t.soSelectFieldTemplate}),ko.components.register("so-checkbox-group",{viewModel:n,template:t.soCheckboxGroupTemplate}),ko.components.register("so-radio-group",{viewModel:n,template:t.soRadioGroupTemplate}),ko.components.register("so-usermulti-group",{viewModel:i,template:t.soUsermultiFieldTemplate}),ko.components.register("so-static-field",{viewModel:o,template:t.soStaticFieldTemplate}),ko.components.register("so-static-person",{viewModel:o,template:t.soStaticFieldTemplate.replace(/data-bind="text: modelValue/g,'data-bind="spPerson: modelValue')}),ko.components.register("so-static-date",{viewModel:o,template:t.soStaticFieldTemplate.replace(/data-bind="text: modelValue/g,'data-bind="spDate: modelValue')}),ko.components.register("so-static-datetime",{viewModel:o,template:t.soStaticFieldTemplate.replace(/data-bind="text: modelValue/g,'data-bind="spDateTime: modelValue')}),ko.components.register("so-static-money",{viewModel:o,template:t.soStaticFieldTemplate.replace(/data-bind="text: modelValue/g,'data-bind="spMoney: modelValue')}),ko.components.register("so-static-number",{viewModel:o,template:t.soStaticFieldTemplate.replace(/data-bind="text: modelValue/g,'data-bind="spNumber: modelValue')}),ko.components.register("so-static-decimal",{viewModel:o,template:t.soStaticFieldTemplate.replace(/data-bind="text: modelValue/g,'data-bind="spDecimal: modelValue')}),ko.components.register("so-static-html",{viewModel:o,template:t.soStaticFieldTemplate.replace(/data-bind="text: modelValue/g,'data-bind="html: modelValue')}),ko.components.register("so-attachments",{viewModel:function(t){function o(){Array.prototype.slice.call(document.getElementById(d.id).files,0).map(n)}function n(t){function o(t,o){if(p.debug&&(console.info("so-html5-attachments.onFileUploadComplete()..."),console.info(arguments)),o&&"success"==o){if("success"==o){var i=new e.SpAttachment(p.getRootUrl(),p.siteUrl,p.listName,p.getItemId(),n);d.attachments.push(i)}}else p.$dialog.html("Error on file upload. Please ensure you upload unique filenames to this form.").dialog("open");setTimeout(function(){d.fileUploads.remove(f)},1e3)}p.debug&&(console.info("uploading file..."),console.info(t));var n=t.name.replace(/[^a-zA-Z0-9_\-\.]/g,""),a=new RegExp("\\b.("+m.join("|")+")$").test(n);if(!a)return void d.errorMsg("Only files with the extensions: "+m.join(", ")+" are allowed.");var l=d.attachments().filter(function(e){return n==e.Name}).length;if(p.debug&&l>0&&console.warn(l+" duplicate files found in Attachments Array"),l>0){var c=n.split(".").slice(-1),h=n.split(".").slice(0,-1).join(".");n=h+"-"+l+"."+c}var f=new i(n,t.size);d.fileUploads().push(f),d.fileUploads.valueHasMutated(),u=new FileReader,u.onerror=r,u.onprogress=function(e){s(e,f)},u.onabort=function(){d.errorMsg("File read cancelled")},u.onloadstart=function(){f.progress(0)},u.onload=function(t){var i=t;f.progress(100),e.SpSoap.addAttachment(i.target.result,n,p.listName,p.viewModel.Id(),p.siteUrl,o)},u.onloadend=function(){},u.readAsDataURL(t)}function i(e,t){this.label=ko.observable(),this.progress=ko.observable(0),this.filename=ko.observable(e),this.kb=ko.observable((t/1024).toFixed(1))}function r(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:d.errorMsg="File Not Found!";break;case e.target.error.NOT_READABLE_ERR:d.errorMsg="File is not readable.";break;case e.target.error.ABORT_ERR:break;default:d.errorMsg="An error occurred reading this file."}}function s(e,t){if(e.lengthComputable){var o=Math.round(e.loaded/e.total*100);100>o&&(t.label(t.filename()+" "+o+"% Complete"),t.progess(o))}}function l(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}var d=this,c=window;if(this.errorMsg=ko.observable(null),!t)throw this.errorMsg("`params` is undefined in component so-attachments"),this.errorMsg();if(!t.val)throw this.errorMsg("Parameter `val` for component so-attachments is required!"),this.errorMsg();var u,p=t.val.getSpForm(),h=p.getViewModel(),m=t.allowedExtensions||p.allowedExtensions;if(this.attachments=t.val,this.label=t.label||"Attach Files",this.drop=t.drop||!1,this.dropLabel=t.dropLabel||"Drag and Drop Files Here",this.className=t.className||"btn btn-primary",this.title=t.title||"Attachments",this.description=t.description,this.readOnly="function"==typeof t.readOnly?t.readOnly:ko.observable(t.readOnly||!1),this.length=ko.pureComputed(function(){return d.attachments().length}),this.fileUploads=ko.observableArray(),this.hasFileReader=ko.observable(c.File&&c.FileReader&&c.FileList&&c.Blob),this.id=t.id||"so_fileUploader_"+a(),!this.hasFileReader()){this.qqFileUploaderId="so_qq_fileUploader_"+a();{var f=new e.FileUploaderSettings(p,this.qqFileUploaderId,p.allowedExtensions);new e.qq.FileUploader(f)}}this.deleteAttachment=function(t){confirm("Are you sure you want to delete "+t.Name+"? This can't be undone.")&&e.SpApi.deleteAttachment(t,function(e,o){return o?void alert("Failed to delete attachment: "+o):void d.attachments.remove(t)})},this.fileHandler=function(){return null==h.Id()?void p.saveListItem(h,!1,void 0,function(){setTimeout(function(){o()},1e3)}):void o()},this.onSelect=function(e){l(e),document.getElementById(d.id).click()},this.onDrop=function(e){l(e);var t=e.dataTransfer,o=t.files;return o?void Array.prototype.slice.call(o,0).map(n):(console.warn("files is "+typeof o),!1)},this.onDragenter=l,this.onDragover=l},template:'<section>\n                    <h4><span data-bind="text: title"></span><span data-bind="text: length" class="badge"></span></h4>\n                    <div data-bind="visible: !!errorMsg()" class="alert alert-danger"><span class="glyphicon glyphicon-exclamation-sign"></span>&nbsp;<span data-bind="text: errorMsg"></span></div> \n                    <!-- ko ifnot: hasFileReader() -->\n                    <div data-bind="visible: !!!readOnly(), attr: {id: this.qqFileUploaderId}"></div>\n                    <!-- /ko -->\n                    <!-- ko if: !readOnly() && hasFileReader() -->\n                        <input type="file" data-bind="attr: {\'id\': id}, event: {\'change\': fileHandler}" multiple class="form-control" style="display:none;" /> \n                        <div data-bind="attr:{\'class\': className}, event: {\'click\': onSelect}"><span class="glyphicon glyphicon-paperclip"></span>&nbsp;<span data-bind="text: label"></span></div> \n                        <!-- ko if: drop --> \n                            <div class="so-file-dropzone" data-bind="event: {\'dragenter\': onDragenter, \'dragover\': onDragover, \'drop\': onDrop}"><div data-bind="text: dropLabel"></div></div>\n                        <!-- /ko -->\n                        <!-- ko foreach: fileUploads -->\n                            <div class="progress"> \n                                <div data-bind="text: label, attr: {\'aria-valuenow\': progress(), \'style\': \'width:\' + progress() + \'%;\' }" class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>  \n                            </div>\n                        <!-- /ko -->\n                    <!-- /ko -->\n                    <div data-bind="foreach: attachments" style="margin:1em auto;">\n                        <div>      \n                            <a href="" data-bind="attr: {href: __metadata.media_src}"><span class="glyphicon glyphicon-paperclip"></span>&nbsp;<span data-bind="text: Name"></span></a>\n                            <!-- ko ifnot: $parent.readOnly() -->\n                            <button data-bind="event: {click: $parent.deleteAttachment}" class="btn btn-sm btn-danger" title="Delete Attachment"><span class="glyphicon glyphicon-remove"></span></button>\n                            <!-- /ko -->\n                        </div>\n                    </div>\n                    <!-- ko if: length() == 0 && readOnly() -->\n                        <p>No attachments have been included.</p> \n                    <!-- /ko -->\n                    <!-- ko if: description -->\n                        <div data-bind="text: description"></div>\n                    <!-- /ko -->\n                </section>'}),ko.components.register("so-created-modified-info",{viewModel:function(e){this.CreatedBy=e.createdBy,this.ModifiedBy=e.modifiedBy,this.profiles=ko.observableArray([{header:"Created By",profile:this.CreatedBy},{header:"Modified By",profile:this.ModifiedBy}]),this.Created=e.created,this.Modified=e.modified,this.showUserProfiles=e.showUserProfiles},template:'<!-- ko if: showUserProfiles() -->\n                        <div class="create-mod-info no-print hidden-xs">\n                            <!-- ko foreach: profiles -->\n                                <div class="user-profile-card">\n                                    <h4 data-bind="text: header"></h4>\n                                    <!-- ko with: profile -->\n                                        <img data-bind="attr: {src: Picture, alt: Name}" />\n                                        <ul>\n                                            <li><label>Name</label><span data-bind="text: Name"></span><li>\n                                            <li><label>Job Title</label><span data-bind="text: JobTitle"></span></li>\n                                            <li><label>Department</label><span data-bind="text: Department"></span></li>\n                                            <li><label>Email</label><a data-bind="text: WorkEMail, attr: {href: (\'mailto:\' + WorkEMail)}"></a></li>\n                                            <li><label>Phone</label><span data-bind="text: WorkPhone"></span></li>\n                                            <li><label>Office</label><span data-bind="text: Office"></span></li>\n                                        </ul>\n                                    <!-- /ko -->\n                                </div>\n                            <!-- /ko -->             \n                        </div>\n                    <!-- /ko -->\n                    <div class="row">\n                        <!-- ko with: CreatedBy -->\n                            <div class="col-md-3"><label>Created By</label> <a data-bind="text: Name, attr: {href: \'mailto:\' + WorkEMail}" class="email"> </a></div>\n                        <!-- /ko -->\n                        <div class="col-md-3"><label>Created</label> <span data-bind="spDateTime: Created"></span></div>                    \n                        <!-- ko with: ModifiedBy -->\n                            <div class="col-md-3"><label>Modified By</label> <a data-bind="text: Name, attr: {href: \'mailto:\' + WorkEMail}" class="email"></a></div>\n                        <!-- /ko -->\n                        <div class="col-md-3"><label>Modified</label> <span data-bind="spDateTime: Modified"></span></div>\n                    </div>'}),ko.components.register("so-workflow-history",{viewModel:function(e){this.historyItems=e.val||e.historyItems},template:'<div class="row">\n                    <div class="col-sm-8"><strong>Description</strong></div>\n                    <div class="col-sm-4"><strong>Date</strong></div>\n                </div>\n                <!-- ko foreach: historyItems -->\n                    <div class="row">\n                        <div class="col-sm-8"><span data-bind="text: _description"></span></div>\n                        <div class="col-sm-4"><span data-bind="spDateTime: _dateOccurred"></span></div>\n                    </div>\n                <!-- /ko -->'})},t.hasErrorCssDiv="<div class=\"form-group\" data-bind=\"css: {'has-error': !!!modelValue() && !!required(), 'has-success has-feedback': !!modelValue() && !!required()}\">",t.requiredFeedbackSpan='<span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>',t.soStaticFieldTemplate='<div class="form-group">\n            <div class="row">            \n                <!-- ko if: !!label -->\n                    <div class="col-sm-3" data-bind="attr:{\'class\': labelColWidth}"><label data-bind="html: label"></label></div>\n                <!-- /ko -->\n                <div class="col-sm-9" data-bind="text: modelValue, attr:{\'class\': fieldColWidth}"></div>\n            </div>\n            <!-- ko if: description -->\n            <div class="so-field-description"><p data-bind="html: description"></p></div>\n            <!-- /ko -->\n        </div>',t.soTextFieldTemplate=t.hasErrorCssDiv+'\n        <div class="row">                 \n	        <!-- ko if: !!label -->\n		        <div class="col-sm-3" data-bind="attr:{\'class\': labelColWidth}"><label data-bind="html: label, attr: {for: id}"></label></div>\n	        <!-- /ko -->          \n	        <div class="col-sm-9" data-bind="attr:{\'class\': fieldColWidth}">\n		        <!-- ko if: readOnly() -->\n			        <div data-bind="text: modelValue"></div>\n		        <!-- /ko -->\n		        <!-- ko ifnot: readOnly() -->\n			        <!-- ko if: multiline -->\n				        <textarea data-bind="value: modelValue, css: {\'so-editable\': editable}, attr: {id: id, placeholder: placeholder, title: title, required: required, \'ko-name\': koName }" class="form-control"></textarea>\n			        <!-- /ko -->\n			        <!-- ko ifnot: multiline -->\n				        <input type="text" data-bind="value: modelValue, css: {\'so-editable\': editable}, attr: {id: id, placeholder: placeholder, title: title, required: required, maxlength: maxlength, \'ko-name\': koName }" class="form-control" />\n			        <!-- /ko -->\n			        <!-- ko if: !!required() -->\n				        '+t.requiredFeedbackSpan+'\n			        <!-- /ko -->\n		        <!-- /ko -->\n	        </div>\n	        <!-- ko if: description -->\n		    <div class="so-field-description"><p data-bind="html: description"></p></div>\n	        <!-- /ko -->\n        </div>',t.soHtmlFieldTemplate=t.hasErrorCssDiv+'\n        <div class="row"> \n            <!-- ko if: !!label -->\n                <div class="col-sm-3" data-bind="attr:{\'class\': labelColWidth}"><label data-bind="html: label, attr: {for: id}"></label></div>\n            <!-- /ko -->\n            <div class="col-sm-9" data-bind="attr:{\'class\': fieldColWidth}">\n                <!-- ko if: readOnly() -->\n                    <div data-bind="html: modelValue"></div>\n                <!-- /ko -->\n                <!-- ko ifnot: readOnly() -->\n                    <div data-bind="spHtmlEditor: modelValue" contenteditable="true" class="form-control content-editable"></div>\n                    <textarea data-bind="value: modelValue, css: {\'so-editable\': editable}, attr: {id: id, required: required, \'ko-name\': koName }" data-sp-html="" style="display:none;"></textarea>\n                    <!-- ko if: !!required() -->\n                        '+t.requiredFeedbackSpan+'\n                    <!-- /ko -->\n                <!-- /ko -->\n                </div>\n            </div>\n            <!-- ko if: description -->\n                <div class="so-field-description"><p data-bind="html: description"></p></div>\n            <!-- /ko -->\n        </div>',t.soCheckboxFieldTemplate='<div class="form-group">\n            <div class="row">\n                <div class="col-sm-3" data-bind="attr:{\'class\': labelColWidth}"></div>\n                <div class="col-sm-9" data-bind="attr:{\'class\': fieldColWidth}">\n                    <!-- ko if: readOnly() -->\n                        <div data-bind="text: !!modelValue() ? \'Yes\' : \'No\'"></div>\n                    <!-- /ko -->\n                    <!-- ko ifnot: readOnly() -->\n                        <label class="checkbox">\n                            <input type="checkbox" data-bind="checked: modelValue, css: {\'so-editable\': editable}, attr: {id: id, \'ko-name\': koName}, valueUpdate: valueUpdate" />\n                            <span data-bind="html: label" style="margin-left:1em;"></span>\n                        </label>\n                    <!-- /ko -->\n                </div>\n            </div>\n            <!-- ko if: description -->\n                <div class="so-field-description"><p data-bind="html: description"></p></div>\n            <!-- /ko -->\n        </div>',t.soSelectFieldTemplate=t.hasErrorCssDiv+'<div class="row">\n                <!-- ko if: !!label -->\n                    <div class="col-sm-3" data-bind="attr:{\'class\': labelColWidth}"><label data-bind="html: label, attr: {for: id}"></label></div>\n                <!-- /ko -->\n                <div class="col-sm-9" data-bind="attr:{\'class\': fieldColWidth}">\n                    <!-- ko if: readOnly() -->\n                        <div data-bind="text: modelValue"></div>\n                    <!-- /ko -->\n                    <!-- ko ifnot: readOnly() -->\n                        <select data-bind="value: modelValue, options: options, optionsCaption: caption, css: {\'so-editable\': editable}, attr: {id: id, title: title, required: required, \'ko-name\': koName}" class="form-control"></select>\n                        <!-- ko if: !!required() -->\n                            '+t.requiredFeedbackSpan+'\n                        <!-- /ko -->\n                    <!-- /ko -->\n                </div>\n            </div>\n            <!-- ko if: description -->\n                <div class="so-field-description"><p data-bind="html: description"></p></div>\n            <!-- /ko -->\n        </div>',t.soCheckboxGroupTemplate='<div class="form-group">\n            <!-- ko if: description -->\n	            <div class="so-field-description"><p data-bind="html: description"></p></div>\n            <!-- /ko -->\n            <div class="row">\n	            <!-- ko if: !!label -->\n		            <div><label data-bind="html: label"></label></div>\n	            <!-- /ko -->\n	            <div>\n		            <!-- ko if: readOnly() -->\n			            <!-- ko ifnot: inline -->\n				            <ul class="list-group">\n					            <!-- ko foreach: modelValue -->\n						            <li data-bind="text: $data" class="list-group-item"></li>\n					            <!-- /ko -->\n					            <!-- ko if: modelValue().length == 0 -->\n						            <li class="list-group-item">--None--</li>\n					            <!-- /ko -->\n				            </ul>\n			            <!-- /ko -->\n			            <!-- ko if: inline -->\n				            <!-- ko foreach: modelValue -->\n					            <span data-bind="text: $data"></span>\n					            <!-- ko if: $index() < $parent.modelValue().length-1 -->,&nbsp;<!-- /ko -->\n				            <!-- /ko -->\n				            <!-- ko if: modelValue().length == 0 -->\n					            <span>--None--</span>\n				            <!-- /ko -->\n			            <!-- /ko -->\n		            <!-- /ko -->\n		            <!-- ko ifnot: readOnly() -->\n			            <input type="hidden" data-bind="value: modelValue, attr:{required: !!required}" /><p data-bind="visible: !!required" class="req">(Required)</p>\n			            <!-- ko foreach: options -->\n				            <label data-bind="css:{\'checkbox\': !$parent.inline, \'checkbox-inline\': $parent.inline}">\n					            <input type="checkbox" data-bind="checked: $parent.modelValue, css: {\'so-editable\': $parent.editable}, attr: {\'ko-name\': $parent.koName, \'value\': $data}" />\n					            <span data-bind="text: $data"></span>\n				            </label>\n			            <!-- /ko -->\n		            <!-- /ko -->\n	            </div>\n            </div>',t.soRadioGroupTemplate='<div class="form-group">\n	        <!-- ko if: description -->\n		        <div class="so-field-description"><p data-bind="html: description"></p></div>\n	        <!-- /ko -->\n	        <div class="row">\n		        <!-- ko if: !!label -->\n			        <div class="col-sm-3" data-bind="attr:{\'class\': labelColWidth}"><label data-bind="html: label"></label></div>\n		        <!-- /ko -->\n		        <div class="col-sm-9" data-bind="attr:{\'class\': fieldColWidth}">\n			        <!-- ko if: readOnly() -->\n				        <div data-bind="text: modelValue"></div>\n			        <!-- /ko -->\n			        <!-- ko ifnot: readOnly() -->\n				        <!-- ko foreach: options -->  \n					        <label data-bind="css:{\'radio\': !$parent.inline, \'radio-inline\': $parent.inline}">\n						        <input type="radio" data-bind="checked: $parent.modelValue, attr:{value: $data, name: $parent.name, \'ko-name\': $parent.koName}, css:{\'so-editable\': $parent.editable}" />\n						        <span data-bind="text: $data"></span>\n					        </label>\n				        <!-- /ko -->\n			        <!-- /ko -->\n		        </div>\n	        </div>\n        </div>',t.soUsermultiFieldTemplate='<div class="form-group">\n	        <input type="hidden" data-bind="value: modelValue, css: {\'so-editable\': editable}, attr: {id: id, \'ko-name\': koName, required: required}" />\n	        <div class="row">\n		        <div class="col-md-3 col-xs-3">\n			        <label data-bind="html: label"></label>\n		        </div>\n		        <div class="col-md-9 col-xs-9">\n			        <!-- ko ifnot: readOnly -->\n				        <input type="text" data-bind="spPerson: person, attr: {placeholder: placeholder}" />\n				        <button class="btn btn-success" data-bind="click: addPerson, attr: {\'disabled\': person() == null, id: koName + \'_AddButton\' }"><span>Add</span></button>\n				        <!-- ko if: showRequiredText -->\n					        <div class="col-md-6 col-xs-6">\n						        <p class="text-danger">At least one person must be added.</p>\n					        </div>\n				        <!-- /ko -->\n			        <!-- /ko -->		\n			        <!-- ko foreach: modelValue -->\n				        <div class="row">\n					        <div class="col-md-10 col-xs-10" data-bind="spPerson: $data"></div>\n					        <!-- ko ifnot: $parent.readOnly() -->\n						        <div class="col-md-2 col-xs-2">\n							        <button class="btn btn-xs btn-danger" data-bind="click: $parent.removePerson"><span class="glyphicon glyphicon-trash"></span></button>\n						        </div>\n					        <!-- /ko -->\n				        </div>\n			        <!-- /ko -->\n			        <!-- ko if: description -->\n				        <div class="so-field-description"><p data-bind="html: description"></p></div>\n			        <!-- /ko -->		\n		        </div>\n	        </div>\n        </div>',t.soCreatedModifiedTemplate='<!-- ko if: !!CreatedBy && CreatedBy() != null -->\n            <section>\n                <so-created-modified-info params="created: Created, createdBy: CreatedBy, modified: Modified, modifiedBy: ModifiedBy, showUserProfiles: showUserProfiles"></so-created-modified-info>\n            </section>\n        <!-- /ko -->',t.soWorkflowHistoryTemplate='<!-- ko if: !!Id() -->\n            <section id="workflowHistory" class="nav-section">\n                <h4>Workflow History</h4>\n                <so-workflow-history params="val: historyItems"></so-workflow-history>\n            </section>\n        <!-- /ko -->',t}();e.KoComponents=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function t(){}return t.peopleSearch=function(e,o,n){function i(e,t){return t?void o(null,t):void o(e,t)}void 0===n&&(n=10);var a="startswith(Name,'{0}')".replace(/\{0\}/g,e),r=null,s="Name",l=10,d=!0;t.getListItems("UserInformationList",i,"/",a,r,s,l,d)},t.getPersonById=function(e,o){t.getListItem("UserInformationList",e,function(e,t){t&&o(null,t),o(e)},"/",!0)},t.executeRestRequest=function(e,t,o,n){void 0===o&&(o=!1),void 0===n&&(n="GET");var i=$.ajax({url:e,type:n,cache:o,dataType:"json",contentType:"application/json; charset=utf-8",headers:{Accept:"application/json;odata=verbose"}});i.done(function(e){t(e)}),i.fail(function(e,o,n){if(o&&"404"==o)var i=o+". The data may have been deleted by another user.";else i=o+" "+n;t(null,i)})},t.getListItem=function(o,n,i,a,r,s){function l(e,t){return t?void i(e,t):void(e&&i(e.d?e.d:e))}void 0===a&&(a="/"),void 0===r&&(r=!1),void 0===s&&(s=null),a=e.Utils.formatSubsiteUrl(a);var d=a+"_vti_bin/listdata.svc/"+e.Utils.toCamelCase(o)+"("+n+")?$expand=CreatedBy,ModifiedBy"+(s?","+s:"");t.executeRestRequest(d,l,r,"GET")},t.getListItems=function(o,n,i,a,r,s,l,d){function c(e,t){var e=e&&"d"in e?e.d:e,o=null;e&&(o="results"in e?e.results:e),n(o,t)}void 0===i&&(i="/"),void 0===a&&(a=null),void 0===r&&(r=null),void 0===s&&(s=null),void 0===l&&(l=10),void 0===d&&(d=!1),i=e.Utils.formatSubsiteUrl(i);var u=[i+"_vti_bin/listdata.svc/"+e.Utils.toCamelCase(o)];a&&u.push("$filter="+a),r&&u.push("$select="+r),s&&u.push("$orderby="+s),u.push("$top="+l),t.executeRestRequest(u.join("&").replace(/\&/,"?"),c,d,"GET")},t.insertListItem=function(e,t,o){void 0===o&&(o=void 0);var n=$.ajax({url:e,type:"POST",processData:!1,contentType:"application/json",data:o?JSON.stringify(o):null,headers:{Accept:"application/json;odata=verbose"}});n.done(function(e){t(e)}),n.fail(function(e,o,n){t(null,o+": "+n)})},t.updateListItem=function(e,t,o){void 0===o&&(o=void 0);var n=$.ajax({url:e.__metadata.uri,type:"POST",processData:!1,contentType:"application/json",data:o?JSON.stringify(o):null,beforeSend:function(t){t.setRequestHeader("X-HTTP-Method","MERGE"),t.setRequestHeader("If-Match",e.__metadata.etag)}});n.done(function(e){t(e)}),n.fail(function(e,o,n){t(null,o+": "+n)})},t.deleteListItem=function(e,t){var o=$.ajax({url:e.__metadata.uri,type:"POST",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","If-Match":e.__metadata.etag}});o.done(function(e){t(e)}),o.fail(function(e,o,n){t(null,n)})},t.deleteAttachment=function(e,t){var o=$.ajax({url:e.__metadata.uri,type:"POST",dataType:"json",contentType:"application/json",headers:{Accept:"application/json;odata=verbose","X-HTTP-Method":"DELETE"}});o.done(function(e){t(e)}),o.fail(function(e,o,n){t(null,o+": "+n)})},t}();e.SpApi=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function e(){}return e.getCurrentUser=function(e,t){void 0===t&&(t=!1);var o=$.ajax({url:"/_api/Web/CurrentUser"+(t?"?$expand=Groups":""),type:"GET",cache:!0,dataType:"json",contentType:"application/json; charset=utf-8",headers:{Accept:"application/json;odata=verbose"}});o.done(function(o){var n=o.d,i={account:n.LoginName,department:null,email:n.Email,groups:[],id:n.Id,jobtitle:null,login:n.LoginName,title:n.Title};if(t){var a=o.d.Groups;
$(a.results).each(function(e,t){i.groups.push({id:t.Id,name:t.Title})})}e(i)}),o.fail(function(t){e(null,t.status)})},e.getUsersGroups=function(e,t){var o=$.ajax({url:"/_api/Web/GetUserById("+e+")/Groups",type:"GET",cache:!0,dataType:"json",contentType:"application/json; charset=utf-8",headers:{Accept:"application/json;odata=verbose"}});o.done(function(e){for(var o=[],n=0;n<e.d.results.length;n++){var i=e.d.results[n];o.push({id:i.Id,name:i.Title})}t(o)}),o.fail(function(e,o,n){t(null,n)})},e}();e.SpApi15=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function t(){}return t.getCurrentUser=function(o){var n={},i='<Query><Where><Eq><FieldRef Name="ID" /><Value Type="Counter"><UserID /></Value></Eq></Where></Query>',a='<ViewFields><FieldRef Name="ID" /><FieldRef Name="Name" /><FieldRef Name="EMail" /><FieldRef Name="Department" /><FieldRef Name="JobTitle" /><FieldRef Name="UserName" /><FieldRef Name="Office" /></ViewFields>';t.getListItems("","User Information List",a,i,function(t){$(t).find("*").filter(function(){return e.Utils.isZrow(this)}).each(function(e,t){n.id=parseInt($(t).attr("ows_ID")),n.title=$(t).attr("ows_Title"),n.login=$(t).attr("ows_Name"),n.email=$(t).attr("ows_EMail"),n.jobtitle=$(t).attr("ows_JobTitle"),n.department=$(t).attr("ows_Department"),n.account=n.id+";#"+n.title,n.groups=[]}),o(n)})},t.getUsersGroups=function(e,t){function o(e){var o=$(e).find("errorstring");if(o&&""!=o.text())return void t(null,o.text());var n=[];$(e).find("Group").each(function(e,t){n.push({id:parseInt($(t).attr("ID")),name:$(t).attr("Name")})}),t(n)}var n='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetGroupCollectionFromUser xmlns="http://schemas.microsoft.com/sharepoint/soap/directory/"><userLoginName>'+e+"</userLoginName></GetGroupCollectionFromUser></soap:Body></soap:Envelope>",i=$.ajax({url:"/_vti_bin/usergroup.asmx",type:"POST",dataType:"xml",data:n,contentType:'text/xml; charset="utf-8"'});i.done(o),i.fail(o)},t.getListItems=function(t,o,n,i,a,r){void 0===r&&(r=25),t=e.Utils.formatSubsiteUrl(t),o||e.Utils.logError("Parameter `listName` is null or undefined in method SpSoap.getListItems()",e.SPForm.errorLogListName,e.SPForm.errorLogSiteUrl);var s='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+o+"</listName><query>"+i+"</query><viewFields>"+n+"</viewFields><rowLimit>"+r+"</rowLimit></GetListItems></soap:Body></soap:Envelope>",l=$.ajax({url:t+"_vti_bin/lists.asmx",type:"POST",dataType:"xml",data:s,headers:{SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetListItems","Content-Type":"text/xml; charset=utf-8"}});l.done(function(e){a(e)}),l.fail(function(e,t,o){a(null,t+": "+o)})},t.getList=function(t,o,n){t=e.Utils.formatSubsiteUrl(t);var i='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetList xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>{0}</listName></GetList></soap:Body></soap:Envelope>'.replace("{0}",o),a=$.ajax({url:t+"_vti_bin/lists.asmx",type:"POST",cache:!1,dataType:"xml",data:i,headers:{SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetList","Content-Type":"text/xml; charset=utf-8"}});a.done(function(e){n(e)}),a.fail(function(e,t,o){n(null,t+": "+o)})},t.checkInFile=function(e,t,o,n){void 0===n&&(n="");var i="http://schemas.microsoft.com/sharepoint/soap/CheckInFile",a=[e,n,t],r='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><CheckInFile xmlns="http://schemas.microsoft.com/sharepoint/soap/"><pageUrl>{0}</pageUrl><comment>{1}</comment><CheckinType>{2}</CheckinType></CheckInFile></soap:Body></soap:Envelope>';return this.executeSoapRequest(i,r,a,null,o)},t.checkOutFile=function(e,t,o,n){var i="http://schemas.microsoft.com/sharepoint/soap/CheckOutFile",a=[e,t,o],r='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><CheckOutFile xmlns="http://schemas.microsoft.com/sharepoint/soap/"><pageUrl>{0}</pageUrl><checkoutToLocal>{1}</checkoutToLocal><lastmodified>{2}</lastmodified></CheckOutFile></soap:Body></soap:Envelope>';return this.executeSoapRequest(i,r,a,null,n)},t.executeSoapRequest=function(t,o,n,i,a,r){void 0===i&&(i="/"),void 0===a&&(a=void 0),void 0===r&&(r="lists.asmx"),i=e.Utils.formatSubsiteUrl(i);try{var s=i+"_vti_bin/"+r;if(null!=n)for(var l=0;l<n.length;l++)o=o.replace("{"+l+"}",null==n[l]?"":n[l]);var d=$.ajax({url:s,cache:!1,type:"POST",data:o,headers:{"Content-Type":"text/xml; charset=utf-8",SOAPAction:t}});a&&d.done(a),d.fail(function(t,o,n){var i="Error in SpSoap.executeSoapRequest. "+o+": "+n+" ";e.Utils.logError(i,e.SPForm.errorLogListName),a(arguments)})}catch(c){e.Utils.logError("Error in SpSoap.executeSoapRequest.",JSON.stringify(c),e.SPForm.errorLogListName),console.warn(c)}},t.updateListItem=function(o,n,i,a,r,s){void 0===a&&(a=!0),void 0===r&&(r="/"),void 0===s&&(s=void 0);for(var l="http://schemas.microsoft.com/sharepoint/soap/UpdateListItems",d='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>{0}</listName><updates>{1}</updates></UpdateListItems></soap:Body></soap:Envelope>',c=a?"New":"Update",u=[n],p="<Batch OnError='Continue'><Method ID='1' Cmd='"+c+"'>",h=0;h<i.length;h++)p+="<Field Name='"+i[h][0]+"'>"+e.Utils.escapeColumnValue(i[h][1])+"</Field>";"New"!==c&&(p+="<Field Name='ID'>"+o+"</Field>"),p+="</Method></Batch>",u.push(p),t.executeSoapRequest(l,d,u,r,s)},t.searchPrincipals=function(e,o,n,i){function a(e){var t=[];$(e).find("PrincipalInfo").each(function(e,o){t.push({AccountName:$("AccountName",o).text(),UserInfoID:parseInt($("UserInfoID",o).text()),DisplayName:$("DisplayName",o).text(),Email:$("Email",o).text(),Title:$("Title",o).text(),IsResolved:"true"==$("IsResolved",o).text()?!0:!1,PrincipalType:$("PrincipalType",o).text()})}),o(t)}void 0===n&&(n=10),void 0===i&&(i="User");var r="http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals",s=[e,n,i],l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><SearchPrincipals xmlns="http://schemas.microsoft.com/sharepoint/soap/"><searchText>{0}</searchText><maxResults>{1}</maxResults><principalType>{2}</principalType></SearchPrincipals></soap:Body></soap:Envelope>';t.executeSoapRequest(r,l,s,"/",a,"People.asmx")},t.addAttachment=function(e,t,o,n,i,a){var r=e.indexOf(",")>-1?e.split(",")[1]:e,s="http://schemas.microsoft.com/sharepoint/soap/AddAttachment",l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><AddAttachment xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>{0}</listName><listItemID>{1}</listItemID><fileName>{2}</fileName><attachment>{3}</attachment></AddAttachment></soap:Body></soap:Envelope>';this.executeSoapRequest(s,l,[o,n,t,r],i,a,"lists.asmx")},t}();e.SpSoap=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function e(e,t){this._description=e||null,this._dateOccurred=t||null}return e}();e.HistoryItem=t;var o=function(){function t(t,o,n,i){void 0===i&&(i=3),this.spForm=t,this.element=o,this.action=t.fileHandlerUrl,this.debug=t.debug,this.multiple=!1,this.maxConnections=i,this.allowedExtensions=n,this.params={listId:t.getListId(),itemId:t.getItemId()},this.template=e.Templates.getFileUploadTemplate()}return t.prototype.onSubmit=function(){},t.prototype.onComplete=function(e,t,o){if(this.spForm.debug&&(console.info("Response from SpForm.fileUploaderSettings.onComplete()"),console.info(arguments)),null!=o.error&&""!=o.error)return this.spForm.logError(o.error),void(this.spForm.debug&&console.warn(o.error));null==this.spForm.getItemId()&&null!=o.itemId&&(this.spForm.setItemId(o.itemId),this.spForm.viewModel.Id(o.itemId),this.spForm.saveListItem(this.spForm.viewModel,!1));var i=new n(this.spForm.getRootUrl(),this.spForm.siteUrl,this.spForm.listName,this.spForm.getItemId(),o.fileName);this.spForm.viewModel.attachments().push(i),this.spForm.viewModel.attachments.valueHasMutated()},t}();e.FileUploaderSettings=o;var n=function(){function t(t,o,n,i,a){var r=n.replace(/\s/g,"");o=e.Utils.formatSubsiteUrl(o);var s=t+o+"_vti_bin/listdata.svc/Attachments(EntitySet='{0}',ItemId={1},Name='{2}')";s=s.replace(/\{0\}/,r).replace(/\{1\}/,i+"").replace(/\{2\}/,a),this.__metadata={uri:s,content_type:"application/octetstream",edit_media:s+"/$value",media_etag:null,media_src:t+o+"/Lists/"+n+"/Attachments/"+i+"/"+a,type:"Microsoft.SharePoint.DataService.AttachmentsItem"},this.EntitySet=r,this.ItemId=i,this.Name=a}return t}();e.SpAttachment=n;var i=function(){function e(){}return e}();e.SpItem=i}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function e(){}return e.getFileUploadTemplate=function(){return e.fileuploadTemplate},e.getFormAction=function(){var t=document.createElement("div");return t.className="form-action no-print",t.innerHTML=e.actionTemplate,t},e.getAttachmentsTemplate=function(t){var o=document.createElement("section");return o.innerHTML=e.attachmentsTemplate.replace(/\{0\}/,t),o},e.attachmentsTemplate='<h4>Attachments <span data-bind="text: attachments().length" class="badge"></span></h4>\n        <div id="{0}"></div>\n        <!-- ko foreach: attachments -->\n        <div class="so-attachment">\n            <a href="" data-bind="attr: {href: __metadata.media_src}"><span class="glyphicon glyphicon-paperclip"></span> <span data-bind="text: Name"></span></a>\n            &nbsp;&nbsp;<button data-bind="event: {click: $root.deleteAttachment}" class="btn btn-sm btn-danger" title="Delete Attachment"><span class="glyphicon glyphicon-trash"></span></button>\n        </div>\n        <!-- /ko -->',e.fileuploadTemplate='\n        <div class="qq-uploader" data-author-only>\n            <div class="qq-upload-drop-area"><span>Drop files here to upload</span></div>\n            <div class="btn btn-primary qq-upload-button"><span class="glyphicon glyphicon-paperclip"></span> Attach File</div>\n            <ul class="qq-upload-list"></ul>\n        </div>',e.actionTemplate='<div class="row">\n            <div class="col-sm-8 col-sm-offset-4 text-right">\n                <label>Logged in as:</label><span data-bind="text: currentUser().title" class="current-user"></span>\n                <button class="btn btn-default cancel" data-bind="event: { click: cancel }" title="Close"><span class="glyphicon glyphicon-remove"></span><span class="hidden-xs">Close</span></button>\n                <!-- ko if: allowPrint() -->\n                    <button class="btn btn-primary print" data-bind="event: {click: print}" title="Print"><span class="glyphicon glyphicon-print"></span><span class="hidden-xs">Print</span></button>\n                <!-- /ko -->\n                <!-- ko if: allowDelete() && Id() != null -->\n                    <button class="btn btn-warning delete" data-bind="event: {click: deleteItem}" title="Delete"><span class="glyphicon glyphicon-remove"></span><span class="hidden-xs">Delete</span></button>\n                <!-- /ko -->\n                <!-- ko if: allowSave() -->\n                    <button class="btn btn-success save" data-bind="event: { click: save }" title="Save your work."><span class="glyphicon glyphicon-floppy-disk"></span><span class="hidden-xs">Save</span></button>\n                <!-- /ko -->\n                <button class="btn btn-danger submit" data-bind="event: { click: submit }" title="Submit for routing."><span class="glyphicon glyphicon-floppy-open"></span><span class="hidden-xs">Submit</span></button>\n            </div>\n        </div>',e}();e.Templates=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function t(){}return t.indexOf=function(e,t){if(Array.prototype.indexOf)return Array.prototype.indexOf.apply(e,[t]);for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},t.formatSubsiteUrl=function(e){return e?/\/$/.test(e)?e:e+"/":"/"},t.toCamelCase=function(e){return e.toString().replace(/\s*\b\w/g,function(e){return(e[1]||e[0]).toUpperCase()}).replace(/\s/g,"").replace(/\'s/,"S").replace(/[^A-Za-z0-9\s]/g,"")},t.getIdFromHash=function(){var e=/\/id\/\d+/i,t=e.exec(window.location.hash),o=t?t[0].replace(/\D/g,""):null;return/\d/.test(o)?parseInt(o):null},t.setIdHash=function(e){window.location.hash="#/id/"+e},t.escapeColumnValue=function(e){return"string"==typeof e?e.replace(/&(?![a-zA-Z]{1,8};)/g,"&amp;"):e},t.getParent=function(e,t){void 0===t&&(t=1);for(var o=0;t>o;o++)e&&(e=e.parentNode);return e},t.getPrevKOComment=function(e){do e=e.previousSibling;while(e&&8!=e.nodeType&&!/^\s*ko/.test(e.textContent));return e},t.getKoComments=function(e){var t=[];return e=e||$("body"),$(e).contents().filter(function(e,t){return 8==t.nodeType&&/^\s*ko/.test(t.nodeValue)}).each(function(e,o){t.push(o.nodeValue.replace(/\s*ko\s*foreach\s*:\s*(\$root\.|)/,"").replace(/\s/g,""))}),t},t.getKoContainerlessControls=function(e){var t=[];return e=e||document.body,$(e).contents().filter(function(e,t){return 8==t.nodeType&&/^\s*ko\s*foreach:/.test(t.nodeValue)}).each(function(e,o){t.push(o)}),t},t.getEditableKoContainerlessControls=function(e){e=e||document.body;for(var o=t.getKoContainerlessControls(e),n=[],i=/(^button|submit|cancel|reset)/i,a=/(input|textarea)/i,r=/\$data/,s=0;s<o.length;s++){var l=t.getNextSibling(o[s]),d=l.getAttribute("data-bind");if(d&&a.test(l.tagName)&&r.test(d)&&i.test(l.getAttribute("type")))n.push(o[s]);else{var c=l.querySelectorAll("input[data-bind*='$data']:enabled, textarea[data-bind*='$data']:enabled");c.length>0&&n.push(o[s])}}return n},t.getEditableKoControlNames=function(e){function t(e,t){var n=i.exec($(t).attr("data-bind")),a=n?n[0].replace(/:(\s+|)/g,"").replace(/\$root\./,"").replace(/\s/g,""):null;null!=a&&o.push(a)}{var o=[],n=/(button|submit|cancel|reset)/,i=/\s*:\s*(\$root.|)\w*\b/;$(e).find("[data-bind]").filter(":input").filter(function(e,t){return!n.test($(t).attr("type"))}).each(t)}return $(e).find('[data-bind][contenteditable="true"]').each(t),o},t.getEditableKoNames=function(e){e=e||document.body;var o=[];$(e).find(".so-editable[ko-name]").each(function(e,n){var i=$(n).attr("ko-name");t.indexOf(o,i)<0&&o.push(i)});for(var n=t.getEditableKoContainerlessControls(e),i=0;i<n.length;i++){var a=n[i].nodeValue.replace(/\s*ko\s*foreach\s*:\s*(\$root\.|)/,"").replace(/\s/g,"");t.indexOf(o,a)<0&&o.push(a)}for(var r=t.getEditableKoControlNames(e),i=0;i<r.length;i++){var a=r[i];t.indexOf(o,a)<0&&o.push(a)}return o},t.getNextSibling=function(e){do e=e.nextSibling;while(1!=e.nodeType);return e},t.observableNameFromControl=function(e,t){void 0===t&&(t=void 0);var o=e.getAttribute("data-bind");if(!o)return null;var n=$(e).attr("ko-name");if(n)return n;var i=/(\b:\s*|\$root\.)\w*\b/,a=i.exec(o);return n=a?a[0].replace(/:(\s+|)/g,"").replace(/\$root\./,"").replace(/\s/g,""):null},t.parseJsonDate=function(e){return t.isJsonDateTicks(e)?new Date(parseInt(e.replace(/\D/g,""))):null},t.parseIsoDate=function(e){return t.isIsoDateString(e)?new Date(e):null},t.isJsonDateTicks=function(e){return e?/\/Date\(\d+\)\//.test(e+""):!1},t.isIsoDateString=function(e){return e?/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z/.test(e+""):!1},t.getQueryParam=function(e){var t=window.escape,o=window.unescape;e=t(o(e));var n=new RegExp("[?&]"+e+"(?:=([^&]*))?","i"),i=n.exec(window.location.search);return null!=i?i[1]:null},t.clone=function(e){if(!(e instanceof Object))return e;var o,n=e.constructor;switch(n){case RegExp:o=new n(e);break;case Date:o=new n(e.getTime());break;default:o=new n}for(var i in e)o[i]=t.clone(e[i]);return o},t.logError=function(o,n,i,a){if(void 0===i&&(i="/"),void 0===a&&(a=!1),a||!e.SPForm.enableErrorLog)throw o;i=t.formatSubsiteUrl(i);var r=window.location.href,s='<p>An error occurred at <a href="'+r+'" target="_blank">'+r+"</a></p><p>Message: "+o+"</p>",l=$.ajax({url:i+"_vti_bin/listdata.svc/"+n.replace(/\s/g,""),type:"POST",processData:!1,contentType:"application/json;odata=verbose",data:JSON.stringify({Title:"Web Form Error",Error:s}),headers:{Accept:"application/json;odata=verbose"}});l.fail(function(e){throw e.responseJSON.error})},t.updateKoField=function(e,t){"input"==e.tagName.toLowerCase()?$(e).val(t):$(e).html(t)},t.validateSpPerson=function(e){return null!=e&&null!=e.toString().match(/^\d*;#/)},t.isTime=function(e){if(!e)return!1;var t=/\d{1,2}:\d{2}(:\d{2}|)\s{0,1}(AM|PM)/;return t.test(e)},t.isDate=function(e){if(!e)return!1;var t=/\d{1,2}\/\d{1,2}\/\d{4}/;return t.test(e.toString())},t.dateToLocaleString=function(e){try{var t=e.getUTCDate();t=10>t?"0"+t:t;var o=e.getUTCMonth()+1;return o=10>o?"0"+o:o,o+"/"+t+"/"+e.getUTCFullYear()}catch(n){return"Invalid Date"}},t.toTimeLocaleObject=function(e){var t,o,n=0;return n=e.getUTCHours(),t=e.getUTCMinutes(),o=n>11?"PM":"AM",10>t&&(t="0"+t),n>12&&(n-=12),{hours:n,minutes:t,tt:o}},t.toTimeLocaleString=function(e){var t=e.getUTCHours(),o=e.getUTCMinutes(),n=t>11?"PM":"AM";return 10>o&&(o="0"+o),t>12?t-=12:0==t&&(t=12),t+":"+o+" "+n},t.toDateTimeLocaleString=function(e){var o=t.toTimeLocaleString(e);return t.dateToLocaleString(e)+" "+o},t.parseDate=function(e){if(!e)return null;if("object"==typeof e&&e.constructor==Date)return e;var t,o,n,i,a=/\d{1,2}\/\d{1,2}\/\d{2,4}/,r=/\d{1,2}-\d{1,2}-\d{2,4}/,s=/\d{4}-\d{1,2}-\d{1,2}/,l=/(\/|)\d{13}(\/|)/,d=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z/,c=null;return e=s.test(e)?e:(e+"").replace(/[^0-9\/\-]/g,""),""==e?null:(a.test(e)||r.test(e)?(t=e.split(a.test(e)?"/":"-"),o=parseInt(t[0])-1,n=parseInt(t[1]),i=parseInt(t[2]),i=100>i?2e3+i:i,c=new Date(i,o,n,0,0,0,0)):s.test(e)?(t=e.split("-"),i=parseInt(t[0]),o=parseInt(t[1])-1,n=parseInt(t[2]),i=100>i?2e3+i:i,c=new Date(i,o,n,0,0,0,0)):d.test(e)?c=new Date(e):l.test(e)&&(c=new Date(parseInt(e.replace(/\D/g,"")))),c)},t.formatMoney=function(e,o,n){void 0===o&&(o="$"),void 0===n&&(n=2);var i=t.unformatNumber(e),a="%s%v",r=a.replace("%v","-%v"),s=i>0?a:0>i?r:a,l=t.formatNumber(Math.abs(i),t.checkPrecision(n));return s.replace("%s",o).replace("%v",l)},t.unformatNumber=function(e){if("number"==typeof e)return e;var t=parseFloat((e+"").replace(/\((.*)\)/,"-$1").replace(/[^0-9-.]/g,""));return isNaN(t)?0:t},t.formatNumber=function(e,o){void 0===o&&(o=0);var n=t.unformatNumber(e),i=t.checkPrecision(o),a=0>n?"-":"",r=parseInt(t.toFixed(Math.abs(n||0),i),10)+"",s=r.length>3?r.length%3:0;return a+(s?r.substr(0,s)+",":"")+r.substr(s).replace(/(\d{3})(?=\d)/g,"$1,")+(i?"."+t.toFixed(Math.abs(n),i).split(".")[1]:"")},t.isString=function(e){return!!(""===e||e&&e.charCodeAt&&e.substr)},t.toFixed=function(e,o){void 0===o&&(o=0),o=t.checkPrecision(o);var n=Math.pow(10,o);return(Math.round(t.unformatNumber(e)*n)/n).toFixed(o)},t.checkPrecision=function(e){return e=Math.round(Math.abs(e)),isNaN(e)?0:e},t.compareArrays=function(e,o){for(var n=[],i=0;i<e.length;i++)for(var a=0;a<o.length;a++)e[i]==o[a]&&t.indexOf(n,o[a])<0&&n.push(o[a]);return n},t.trim=function(e){return t.isString(e)?e.replace(/(^\s+|\s+$)/g,""):e},t.formatPictureUrl=function(e){return null==e?"/_layouts/images/person.gif":e.indexOf(",")>-1?e.split(",")[0]:e},t.isZrow=function(e){return"z:row"==e.nodeName.toLowerCase()},t.koNameFromControl=t.observableNameFromControl,t}();e.Utils=t}(Shockout||(Shockout={}));var Shockout;!function(Shockout){Shockout.qq=Shockout.qq||{},Shockout.qq.extend=function(e,t){for(var o in t)e[o]=t[o]},Shockout.qq.indexOf=function(e,t,o){if(e.indexOf)return e.indexOf(t,o);o=o||0;var n=e.length;for(0>o&&(o+=n);n>o;o++)if(o in e&&e[o]===t)return o;return-1},Shockout.qq.getUniqueId=function(){var e=0;return function(){return e++}}(),Shockout.qq.attach=function(e,t,o){e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&e.attachEvent("on"+t,o)},Shockout.qq.detach=function(e,t,o){e.removeEventListener?e.removeEventListener(t,o,!1):e.attachEvent&&e.detachEvent("on"+t,o)},Shockout.qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},Shockout.qq.insertBefore=function(e,t){t.parentNode.insertBefore(e,t)},Shockout.qq.remove=function(e){e.parentNode.removeChild(e)},Shockout.qq.contains=function(e,t){return e==t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e))},Shockout.qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var o=e.firstChild;return e.removeChild(o),o}}(),Shockout.qq.css=function(e,t){null!=t.opacity&&"string"!=typeof e.style.opacity&&"undefined"!=typeof e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),Shockout.qq.extend(e.style,t)},Shockout.qq.hasClass=function(e,t){var o=new RegExp("(^| )"+t+"( |$)");return o.test(e.className)},Shockout.qq.addClass=function(e,t){Shockout.qq.hasClass(e,t)||(e.className+=" "+t)},Shockout.qq.removeClass=function(e,t){var o=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(o," ").replace(/^\s+|\s+$/g,"")},Shockout.qq.setText=function(e,t){e.innerText=t,e.textContent=t},Shockout.qq.children=function(e){for(var t=[],o=e.firstChild;o;)1==o.nodeType&&t.push(o),o=o.nextSibling;return t},Shockout.qq.getByClass=function(e,t){if(e.querySelectorAll)return e.querySelectorAll("."+t);for(var o=[],n=e.getElementsByTagName("*"),i=n.length,a=0;i>a;a++)Shockout.qq.hasClass(n[a],t)&&o.push(n[a]);return o},Shockout.qq.obj2url=function(e,t,o){var n=[],i="&",a=function(e,o){var i=t?/\[\]$/.test(t)?t:t+"["+o+"]":o;"undefined"!=i&&"undefined"!=o&&n.push("object"==typeof e?Shockout.qq.obj2url(e,i,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))};if(!o&&t)i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",n.push(t),n.push(Shockout.qq.obj2url(e));else if("[object Array]"===Object.prototype.toString.call(e)&&"undefined"!=typeof e)for(var r=0,s=e.length;s>r;++r)a(e[r],r);else if("undefined"!=typeof e&&null!==e&&"object"==typeof e)for(var l in e)a(e[l],l);else n.push(encodeURIComponent(t)+"="+encodeURIComponent(e));return n.join(i).replace(/^&/,"").replace(/%20/g,"+")},Shockout.qq.FileUploaderBasic=function(e){this._options={debug:!1,action:"/server/upload",params:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(e){alert(e)}},Shockout.qq.extend(this._options,e),this._filesInProgress=0,this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},Shockout.qq.FileUploaderBasic.prototype={setParams:function(e){this._options.params=e},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(e){var t=this;return new Shockout.qq.UploadButton({element:e,multiple:this._options.multiple&&Shockout.qq.UploadHandlerXhr.isSupported(),onChange:function(e){t._onInputChange(e)}})},_createUploadHandler:function(){var e,t=this;e=Shockout.qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm";var o=new Shockout.qq[e]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(e,o,n,i){t._onProgress(e,o,n,i),t._options.onProgress(e,o,n,i)},onComplete:function(e,o,n){t._onComplete(e,o,n),t._options.onComplete(e,o,n)},onCancel:function(e,o){t._onCancel(e,o),t._options.onCancel(e,o)}});return o},_preventLeaveInProgress:function(){var e=this;Shockout.qq.attach(window,"beforeunload",function(t){if(e._filesInProgress){var t=t||window.event;return t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave}})},_onSubmit:function(){this._filesInProgress++},_onProgress:function(){},_onComplete:function(e,t,o){this._filesInProgress--,o.error&&this._options.showMessage(o.error)},_onCancel:function(){this._filesInProgress--},_onInputChange:function(e){this._handler instanceof Shockout.qq.UploadHandlerXhr?this._uploadFileList(e.files):this._validateFile(e)&&this._uploadFile(e),this._button.reset()},_uploadFileList:function(e){for(var t=0;t<e.length;t++)if(!this._validateFile(e[t]))return;for(var t=0;t<e.length;t++)this._uploadFile(e[t])},_uploadFile:function(e){var t=this._handler.add(e),o=this._handler.getName(t);this._options.onSubmit(t,o)!==!1&&(this._onSubmit(t,o),this._handler.upload(t,this._options.params))},_validateFile:function(e){var t,o;return e.value?t=e.value.replace(/.*(\/|\\)/,""):(t=null!=e.fileName?e.fileName:e.name,o=null!=e.fileSize?e.fileSize:e.size),this._isAllowedExtension(t)?0===o?(this._error("emptyError",t),!1):o&&this._options.sizeLimit&&o>this._options.sizeLimit?(this._error("sizeError",t),!1):o&&o<this._options.minSizeLimit?(this._error("minSizeError",t),!1):!0:(this._error("typeError",t),!1)},_error:function(e,t){function o(e,t){n=n.replace(e,t)}var n=this._options.messages[e];o("{file}",this._formatFileName(t)),o("{extensions}",this._options.allowedExtensions.join(", ")),o("{sizeLimit}",this._formatSize(this._options.sizeLimit)),o("{minSizeLimit}",this._formatSize(this._options.minSizeLimit)),this._options.showMessage(n)},_formatFileName:function(e){return e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-13)),e},_isAllowedExtension:function(e){var t=-1!==e.indexOf(".")?e.replace(/.*[.]/,"").toLowerCase():"",o=this._options.allowedExtensions;if(!o.length)return!0;for(var n=0;n<o.length;n++)if(o[n].toLowerCase()==t)return!0;return!1},_formatSize:function(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][t]}},Shockout.qq.FileUploader=function(e){function t(){o._element.innerHTML=o._options.template,o._listElement=o._options.listElement||o._find(o._element,"list"),o._classes=o._options.classes,o._button=o._createUploadButton(o._find(o._element,"button")),o._bindCancelEvent(),o._setupDragDrop()}var o=this;if(Shockout.qq.FileUploaderBasic.apply(this,arguments),Shockout.qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Attach File</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}}),Shockout.qq.extend(this._options,e),this._element=Shockout.Utils.isString(this._options.element)?document.getElementById(this._options.element):this._options.element,null==this._element&&Shockout.Utils.isString(this._options.element)){var n;n=setInterval(function(){o._element=document.getElementById(o._options.element),null!=o._element&&(clearInterval(n),t())},50)}else t()},Shockout.qq.extend(Shockout.qq.FileUploader.prototype,Shockout.qq.FileUploaderBasic.prototype),Shockout.qq.extend(Shockout.qq.FileUploader.prototype,{_find:function(e,t){var o=Shockout.qq.getByClass(e,this._options.classes[t])[0];if(!o)throw new Error("element not found "+t);return o},_setupDragDrop:function(){var e=this,t=this._find(this._element,"drop"),o=new Shockout.qq.UploadDropZone({element:t,onEnter:function(o){Shockout.qq.addClass(t,e._classes.dropActive),o.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(){Shockout.qq.removeClass(t,e._classes.dropActive)},onDrop:function(o){t.style.display="none",Shockout.qq.removeClass(t,e._classes.dropActive),e._uploadFileList(o.dataTransfer.files)}});t.style.display="none",Shockout.qq.attach(document,"dragenter",function(e){o._isValidFileDrag(e)&&(t.style.display="block")}),Shockout.qq.attach(document,"dragleave",function(e){if(o._isValidFileDrag(e)){var n=document.elementFromPoint(e.clientX,e.clientY);n&&"HTML"!=n.nodeName||(t.style.display="none")}})},_onSubmit:function(e,t){Shockout.qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onProgress:function(e,t,o,n){Shockout.qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var i=this._getItemByFileId(e),a=this._find(i,"size");a.style.display="inline";var r;r=o!=n?Math.round(o/n*100)+"% from "+this._formatSize(n):this._formatSize(n),Shockout.qq.setText(a,r)},_onComplete:function(e,t,o){Shockout.qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var n=this._getItemByFileId(e);Shockout.qq.remove(this._find(n,"cancel")),Shockout.qq.remove(this._find(n,"spinner")),o.success?Shockout.qq.addClass(n,this._classes.success):Shockout.qq.addClass(n,this._classes.fail)},_addToList:function(e,t){var o=Shockout.qq.toElement(this._options.fileTemplate);o.qqFileId=e;var n=this._find(o,"file");Shockout.qq.setText(n,this._formatFileName(t)),this._find(o,"size").style.display="none",this._listElement.appendChild(o)},_getItemByFileId:function(e){for(var t=this._listElement.firstChild;t;){if(t.qqFileId==e)return t;t=t.nextSibling}},_bindCancelEvent:function(){var e=this,t=this._listElement;Shockout.qq.attach(t,"click",function(t){t=t||window.event;var o=t.target||t.srcElement;if(Shockout.qq.hasClass(o,e._classes.cancel)){Shockout.qq.preventDefault(t);var n=o.parentNode;e._handler.cancel(n.qqFileId),Shockout.qq.remove(n)}})}}),Shockout.qq.UploadDropZone=function(e){this._options={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},Shockout.qq.extend(this._options,e),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},Shockout.qq.UploadDropZone.prototype={_disableDropOutside:function(){Shockout.qq.UploadDropZone.dropOutsideDisabled||(Shockout.qq.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),Shockout.qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var e=this;Shockout.qq.attach(e._element,"dragover",function(t){if(e._isValidFileDrag(t)){var o=t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"==o||"linkMove"==o?"move":"copy",t.stopPropagation(),t.preventDefault()}}),Shockout.qq.attach(e._element,"dragenter",function(t){e._isValidFileDrag(t)&&e._options.onEnter(t)}),Shockout.qq.attach(e._element,"dragleave",function(t){if(e._isValidFileDrag(t)){e._options.onLeave(t);
var o=document.elementFromPoint(t.clientX,t.clientY);Shockout.qq.contains(this,o)||e._options.onLeaveNotDescendants(t)}}),Shockout.qq.attach(e._element,"drop",function(t){e._isValidFileDrag(t)&&(t.preventDefault(),e._options.onDrop(t))})},_isValidFileDrag:function(e){var t=e.dataTransfer,o=navigator.userAgent.indexOf("AppleWebKit")>-1;return t&&"none"!=t.effectAllowed&&(t.files||!o&&t.types.contains&&t.types.contains("Files"))}},Shockout.qq.UploadButton=function(e){this._options={element:null,multiple:!1,name:"file",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},Shockout.qq.extend(this._options,e),this._element=this._options.element,Shockout.qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},Shockout.qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&Shockout.qq.remove(this._input),Shockout.qq.removeClass(this._element,this._options.focusClass),this._input=this._createInput()},_createInput:function(){var e=document.createElement("input");this._options.multiple&&e.setAttribute("multiple","multiple"),e.setAttribute("type","file"),e.setAttribute("name",this._options.name),Shockout.qq.css(e,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(e);var t=this;return Shockout.qq.attach(e,"change",function(){t._options.onChange(e)}),Shockout.qq.attach(e,"mouseover",function(){Shockout.qq.addClass(t._element,t._options.hoverClass)}),Shockout.qq.attach(e,"mouseout",function(){Shockout.qq.removeClass(t._element,t._options.hoverClass)}),Shockout.qq.attach(e,"focus",function(){Shockout.qq.addClass(t._element,t._options.focusClass)}),Shockout.qq.attach(e,"blur",function(){Shockout.qq.removeClass(t._element,t._options.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}},Shockout.qq.UploadHandlerAbstract=function(e){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(){},onComplete:function(){},onCancel:function(){}},Shockout.qq.extend(this._options,e),this._queue=[],this._params=[]},Shockout.qq.UploadHandlerAbstract.prototype={log:function(e){this._options.debug&&window.console&&console.log("[uploader] "+e)},add:function(){},upload:function(e,t){var o=this._queue.push(e),n={};Shockout.qq.extend(n,t),this._params[e]=n,o<=this._options.maxConnections&&this._upload(e,this._params[e])},cancel:function(e){this._cancel(e),this._dequeue(e)},cancelAll:function(){for(var e=0;e<this._queue.length;e++)this._cancel(this._queue[e]);this._queue=[]},getName:function(){},getSize:function(){},getQueue:function(){return this._queue},_upload:function(){},_cancel:function(){},_dequeue:function(e){var t=Shockout.qq.indexOf(this._queue,e);this._queue.splice(t,1);var o=this._options.maxConnections;if(this._queue.length>=o){var n=this._queue[o-1];this._upload(n,this._params[n])}}},Shockout.qq.UploadHandlerForm=function(){Shockout.qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={}},Shockout.qq.extend(Shockout.qq.UploadHandlerForm.prototype,Shockout.qq.UploadHandlerAbstract.prototype),Shockout.qq.extend(Shockout.qq.UploadHandlerForm.prototype,{add:function(e){e.setAttribute("name","qqfile");var t="qq-upload-handler-iframe"+Shockout.qq.getUniqueId();return this._inputs[t]=e,e.parentNode&&Shockout.qq.remove(e),t},getName:function(e){return this._inputs[e].value.replace(/.*(\/|\\)/,"")},_cancel:function(e){this._options.onCancel(e,this.getName(e)),delete this._inputs[e];var t=document.getElementById(e);t&&(t.setAttribute("src","javascript:false;"),Shockout.qq.remove(t))},_upload:function(e,t){var o=this._inputs[e];if(!o)throw new Error("file with passed id was not added, or already uploaded or cancelled");var n=this.getName(e),i=this._createIframe(e),a=this._createForm(i,t);a.appendChild(o);var r=this;return this._attachLoadEvent(i,function(){r.log("iframe loaded");var t=r._getIframeContentJSON(i);r._options.onComplete(e,n,t),r._dequeue(e),delete r._inputs[e],setTimeout(function(){Shockout.qq.remove(i)},1)}),a.submit(),Shockout.qq.remove(a),e},_attachLoadEvent:function(e,t){Shockout.qq.attach(e,"load",function(){e.parentNode&&(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML||t())})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}return response},_createIframe:function(e){var t=Shockout.qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e,t){var o=Shockout.qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),n=Shockout.qq.obj2url(t,this._options.action);return o.setAttribute("action",n),o.setAttribute("target",e.name),o.style.display="none",document.body.appendChild(o),o}}),Shockout.qq.UploadHandlerXhr=function(){Shockout.qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},Shockout.qq.UploadHandlerXhr.isSupported=function(){var e=document.createElement("input");return e.type="file","multiple"in e&&"undefined"!=typeof File&&"undefined"!=typeof(new XMLHttpRequest).upload},Shockout.qq.extend(Shockout.qq.UploadHandlerXhr.prototype,Shockout.qq.UploadHandlerAbstract.prototype),Shockout.qq.extend(Shockout.qq.UploadHandlerXhr.prototype,{add:function(e){if(!(e instanceof File))throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(e)-1},getName:function(e){var t=this._files[e];return null!=t.fileName?t.fileName:t.name},getSize:function(e){var t=this._files[e];return null!=t.fileSize?t.fileSize:t.size},getLoaded:function(e){return this._loaded[e]||0},_upload:function(e,t){{var o=this._files[e],n=this.getName(e);this.getSize(e)}this._loaded[e]=0;var i=this._xhrs[e]=new XMLHttpRequest,a=this;i.upload.onprogress=function(t){t.lengthComputable&&(a._loaded[e]=t.loaded,a._options.onProgress(e,n,t.loaded,t.total))},i.onreadystatechange=function(){4==i.readyState&&a._onComplete(e,i)},t=t||{},t.qqfile=n;var r=Shockout.qq.obj2url(t,this._options.action);i.open("POST",r,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("X-File-Name",encodeURIComponent(n)),i.setRequestHeader("Content-Type","application/octet-stream"),i.send(o)},_onComplete:function(id,xhr){if(this._files[id]){var name=this.getName(id),size=this.getSize(id);if(this._options.onProgress(id,name,size,size),200==xhr.status){this.log("xhr - server response received"),this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else this._options.onComplete(id,name,{});this._files[id]=null,this._xhrs[id]=null,this._dequeue(id)}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),this._files[e]=null,this._xhrs[e]&&(this._xhrs[e].abort(),this._xhrs[e]=null)}})}(Shockout||(Shockout={}));