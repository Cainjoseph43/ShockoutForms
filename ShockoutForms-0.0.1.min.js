"use strict";var Shockout;!function(e){var t=function(){function t(o,i,n){this.allowDelete=!1,this.allowPrint=!0,this.allowSave=!1,this.allowedExtensions=["txt","rtf","zip","pdf","doc","docx","jpg","gif","png","ppt","tif","pptx","csv","pub","msg"],this.attachmentMessage="An attachment is required.",this.confirmationUrl="/SitePages/Confirmation.aspx",this.debug=!1,this.editableFields=[],this.enableAttachments=!1,this.enableErrorLog=!0,this.errorLogListName="Error Log",this.fileHandlerUrl="/_layouts/webster/SPFormFileHandler.ashx",this.includeUserProfiles=!0,this.includeWorkflowHistory=!0,this.requireAttachments=!1,this.siteUrl="",this.utils=e.Utils,this.workflowHistoryListName="Workflow History",this.requireCheckout=!1,this.rootUrl=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),this.version="0.0.1",this.viewModelIsBound=!1;var r,a=this;if(!(this instanceof t))throw r="You must declare an instance of this class with `new`.",alert(r),r;if(!i||!o){var s=["Missing required parameters:"];throw this.formId||s.push(" `formId`"),this.listName||s.push(" `listName`"),s=s.join(""),alert(s),s}if(this.formId=i,this.listName=o,e.Utils.getQueryParam("id")?this.itemId=parseInt(e.Utils.getQueryParam("id")):e.Utils.getQueryParam("formid")&&(this.itemId=parseInt(e.Utils.getQueryParam("formid"))),this.sourceUrl=e.Utils.getQueryParam("source"),this.sourceUrl&&(this.sourceUrl=decodeURIComponent(this.sourceUrl)),n&&n.constructor===Object)for(var l in n)this[l]=n[l];this.form=document.getElementById(this.formId),this.$form=$(this.form),a.$formStatus=$("<div>",{"class":"form-status"}).appendTo(a.$form),a.$dialog=$("<div>",{id:"formdialog"}).appendTo(a.$form).dialog({autoOpen:!1,show:{effect:"blind",duration:1e3},hide:{effect:"explode",duration:1e3}}),t.errorLogListName=this.errorLogListName,this.viewModel=new e.ViewModel(this),this.asyncFns=[a.getListAsync,function(){a.preRender&&a.preRender(a),a.nextAsync(!0)},a.getCurrentUserAsync,a.getUsersGroupsAsync,a.restrictSpGroupElementsAsync,a.initFormAsync,a.getListItemAsync,a.getAttachmentsAsync,a.getHistoryAsync,function(){a.postRender&&a.postRender(a),a.nextAsync(!0)}],this.nextAsync(!0,"Begin initialization...")}return t.prototype.getCurrentUser=function(){return this.currentUser},t.prototype.getDefaultViewUrl=function(){return this.defaultViewUrl},t.prototype.getDefailtMobileViewUrl=function(){return this.defailtMobileViewUrl},t.prototype.getForm=function(){return this.form},t.prototype.getItemId=function(){return this.itemId},t.prototype.getListId=function(){return this.listId},t.prototype.getListItem=function(){return this.listItem},t.prototype.requiresCheckout=function(){return this.requireCheckout},t.prototype.getRootUrl=function(){return this.rootUrl},t.prototype.getSourceUrl=function(){return this.sourceUrl},t.prototype.getViewModel=function(){return this.viewModel},t.prototype.getVersion=function(){return this.version},t.prototype.nextAsync=function(e,t,o){void 0===e&&(e=void 0),void 0===t&&(t=void 0),void 0===o&&(o=void 0);var i=this;return e=e||!0,t&&this.updateStatus(t,e),e?0==this.asyncFns.length?void setTimeout(function(){i.$formStatus.slideDown()},2e3):void this.asyncFns.shift()(i,o):void 0},t.prototype.initFormAsync=function(t,o){void 0===o&&(o=void 0);try{t.updateStatus("Initializing dynamic form features..."),t.$createdInfo=t.$form.find(".created-info"),t.$formAction=$(e.Templates.getFormAction(t.allowSave,t.allowDelete,t.allowPrint)).appendTo(t.$form),t.itemId&&(t.$createdInfo.html(e.Templates.getCreatedModifiedInfo().innerHTML),t.includeWorkflowHistory&&t.$form.append(e.Templates.getHistoryTemplate())),0==t.editableFields.length&&(t.$form.find("[data-bind]").each(function(o,i){var n=e.Utils.observableNameFromControl(i);!n||t.editableFields.indexOf(n)>-1||null!=n.match(/^(_|\$)/)||("INPUT"==i.tagName||"SELECT"==i.tagName||"TEXTAREA"==i.tagName||"true"==$(i).attr("contenteditable"))&&t.editableFields.push(n)}),t.editableFields.sort()),t.fileUploaderSettings={element:null,action:t.fileHandlerUrl,debug:t.debug,multiple:!1,maxConnections:3,allowedExtensions:t.allowedExtensions,params:{listId:t.listId,itemId:t.itemId},onSubmit:function(){},onComplete:function(e,o,i){null==t.itemId&&(t.viewModel.Id(i.itemId),t.itemId=i.itemId,t.saveListItem(t.viewModel,!1)),null==i.error&&null!=i.fileName&&t.getAttachmentsAsync()},template:e.Templates.getFileUploadTemplate()},t.$form.find(".attachments").each(function(o,i){var n="fileuploader_"+o;$(i).append(e.Templates.getAttachmentsTemplate(n)),t.fileUploaderSettings.element=document.getElementById(n),t.fileUploader=new e.qq.FileUploader(t.fileUploaderSettings)}),t.$form.find("[required]").addClass("required"),t.nextAsync(!0,"Form initialized.")}catch(i){t.debug&&console.warn(i),t.logError("initFormAsync: "+i),t.nextAsync(!1,"Failed to initialize form. "+i)}},t.prototype.getCurrentUserAsync=function(e,t){void 0===t&&(t=void 0);try{var o='<Query><Where><Eq><FieldRef Name="ID" /><Value Type="Counter"><UserID /></Value></Eq></Where></Query>',i='<ViewFields><FieldRef Name="ID" /><FieldRef Name="Name" /><FieldRef Name="EMail" /><FieldRef Name="Department" /><FieldRef Name="JobTitle" /><FieldRef Name="UserName" /><FieldRef Name="Office" /></ViewFields>';e.getListItemsSoap("","User Information List",i,o,function(t){var o={id:null,title:null,login:null,email:null,account:null,jobtitle:null,department:null,groups:[]};$(t.responseXML).find("*").filter(function(){return"z:row"===this.nodeName}).each(function(e,t){o.id=parseInt($(t).attr("ows_ID")),o.title=$(t).attr("ows_Name"),o.login=$(t).attr("ows_UserName"),o.email=$(t).attr("ows_EMail"),o.jobtitle=$(t).attr("ows_JobTitle"),o.department=$(t).attr("ows_Department"),o.account=o.id+";#"+o.login}),e.currentUser=o,e.viewModel.currentUser(o),e.nextAsync(!0,"Retrieved your account.")})}catch(n){e.debug&&console.warn(n),e.logError("getCurrentUserAsync():"+n),e.nextAsync(!1,"Failed to retrieve your account.")}},t.prototype.getUsersGroupsAsync=function(e,t){void 0===t&&(t=void 0);try{var o="Retrieved your groups.";if(0==e.$form.find("[user-groups]").length)return void e.nextAsync(!0,o);var i='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetGroupCollectionFromUser xmlns="http://schemas.microsoft.com/sharepoint/soap/directory/"><userLoginName>'+e.currentUser.login+"</userLoginName></GetGroupCollectionFromUser></soap:Body></soap:Envelope>",n=$.ajax({url:e.rootUrl+e.siteUrl+"/_vti_bin/usergroup.asmx",type:"POST",dataType:"xml",data:i,contentType:'text/xml; charset="utf-8"'});n.done(function(t,o,i){$(i.responseXML).find("Group").each(function(t,o){e.currentUser.groups.push({id:parseInt($(o).attr("ID")),name:$(o).attr("Name")})}),e.nextAsync(!0,"Retrieved your groups.")}),n.fail(function(t,o){var i="Failed to retrieve your groups: "+o;e.logError(i),e.nextAsync(!1,i)}),e.updateStatus("Retrieving your groups...")}catch(r){e.debug&&console.warn(r),e.logError("getUsersGroupsAsync: "+r),e.nextAsync(!1,"Failed to retrieve your groups.")}},t.prototype.restrictSpGroupElementsAsync=function(e,t){void 0===t&&(t=void 0);try{e.updateStatus("Retrieving your permissions..."),e.$form.find("[user-groups]").each(function(t,o){var i=$(o).attr("user-groups"),n=null!=i.match(/\,/)?i.split(","):[i],r=0;$.each(n,function(t,o){o=null!=o.match(/\;#/)?o.split(";")[0]:o,o=$.trim(o),$.each(e.currentUser.groups,function(e,t){(o==t.name||parseInt(o)==t.id)&&r++})}),r>0?$(o).show():$(o).remove()}),e.nextAsync(!0,"Retrieved your permissions.")}catch(o){e.debug&&console.warn(o),e.logError("restrictSpGroupElementsAsync: "+o),e.nextAsync(!0,"Failed to retrieve your permissions.")}},t.prototype.getListItemAsync=function(t,o){function i(o){t.listItem=e.Utils.clone(o.d),t.bindListItemValues(t),t.nextAsync(!0,"Retrieved form data.")}function n(e,o,i){if(e.status&&"404"==e.status)var n=e.statusText+". The form may have been deleted by another user.";else n=o+" "+i;t.showDialog(n),t.nextAsync(!1,n)}void 0===o&&(o=void 0);try{if(t.updateStatus("Retrieving form values..."),!t.itemId)return void t.nextAsync(!0,"This is a New form.");var r=t.rootUrl+t.siteUrl+"/_vti_bin/listdata.svc/"+t.listName.replace(/\s/g,"")+"("+t.itemId+")";t.getListItemsRest(r,i,n)}catch(a){t.debug&&console.warn(a)}},t.prototype.getHistoryAsync=function(t,o){void 0===o&&(o=void 0);try{if(!t.itemId||!t.includeWorkflowHistory)return void t.nextAsync(!0);var i=[],n=t.rootUrl+t.siteUrl+"/_vti_bin/listdata.svc/"+t.workflowHistoryListName.replace(/\s/g,"")+"?$filter=ListID eq '"+t.listId+"' and PrimaryItemID eq "+t.itemId+"&$select=Description,DateOccurred&$orderby=DateOccurred asc";t.getListItemsRest(n,function(o){$(o.d.results).each(function(t,o){i.push(new e.HistoryItem(o.Description,e.Utils.parseJsonDate(o.DateOccurred)))}),t.viewModel.history(i),t.nextAsync(!0,"Retrieved workflow history.")})}catch(r){var a=t.rootUrl+t.siteUrl+"/Lists/"+t.workflowHistoryListName.replace(/\s/g,"%20");t.logError('The Workflow History list may be full at <a href="{url}">{url}</a>. Failed to retrieve workflow history in method, getHistoryAsync(). Error: '.replace(/\{url\}/g,a)+JSON.stringify(r)),t.nextAsync(!0,"Failed to retrieve workflow history.")}},t.prototype.bindListItemValues=function(t){void 0===t&&(t=void 0),t=t||this;var o=new RegExp("^(__metadata|ContentTypeID|ContentType|CreatedBy|ModifiedBy|Owshiddenversion|Version|Attachments|Path)"),i=t.listItem;for(var n in i)o.test(n)||t.viewModel[n]||(null!=i[n]&&i[n].constructor===Object&&i[n].__deferred?i[n+"Value"]?t.viewModel[n]=ko.observable(i[n+"Value"]):i[n+"Id"]&&(t.viewModel[n]=ko.observable(i[n+"Id"])):null!=i[n]&&e.Utils.isJsonDate(i[n])?t.viewModel[n]=ko.observable(e.Utils.parseJsonDate(i[n])):(/submitted/i.test(n)&&(t.allowSave=!0,t.$formAction.find(".btn.save").show(),e.ViewModel.isSubmittedKey=n),t.viewModel[n]=ko.observable(i[n])));t.viewModelIsBound||(ko.applyBindings(t.viewModel,t.form),t.viewModelIsBound=!0),t.getListItemsRest(i.CreatedBy.__deferred.uri,function(o){var i=o.d;t.viewModel.CreatedBy(i),t.viewModel.isAuthor(t.currentUser.id==i.Id),t.viewModel.CreatedByName(i.Name),t.viewModel.CreatedByEmail(i.WorkEMail),t.includeUserProfiles&&t.$createdInfo.find(".create-mod-info").prepend(e.Templates.getUserProfileTemplate(i,"Created By"))}),t.getListItemsRest(i.ModifiedBy.__deferred.uri,function(o){var i=o.d;t.viewModel.ModifiedBy(i),t.viewModel.ModifiedByName(i.Name),t.viewModel.ModifiedByEmail(i.WorkEMail),t.includeUserProfiles&&t.$createdInfo.find(".create-mod-info").append(e.Templates.getUserProfileTemplate(i,"Last Modified By"))})},t.prototype.deleteListItem=function(e){var t=e.parent,o=t.listItem,i=3e3;$.ajax({url:o.__metadata.uri,type:"POST",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","If-Match":o.__metadata.etag},success:function(){t.showDialog("The form was deleted. You'll be redirected in "+i/1e3+" seconds."),setTimeout(function(){window.location.replace(null!=t.sourceUrl?t.sourceUrl:t.rootUrl)},i)},error:function(e){throw e.responseJSON.error}})},t.prototype.saveListItem=function(t,o,i,n){void 0===o&&(o=!0),void 0===i&&(i=!0),void 0===n&&(n=void 0);var r,a=t.parent,s=!a.itemId,l=3e3,c=n||"<p>Your form has been saved.</p>",u={},d={Accept:"application/json;odata=verbose"},p="application/json";if(a.preSave){var h=a.preSave(a);if("undefined"!=typeof h&&!h)return}if(!o||a.formIsValid(t,!0)){$.each(a.editableFields,function(e,o){u[o]=t[o]()}),"undefined"==typeof t[e.ViewModel.isSubmittedKey]||null!=t[e.ViewModel.isSubmittedKey]()&&0!=t[e.ViewModel.isSubmittedKey]()||(u[e.ViewModel.isSubmittedKey]=o),s?(r=a.rootUrl+a.siteUrl+"/_vti_bin/listdata.svc/"+a.listName.replace(/\s/g,"")+"("+a.itemId+")",p+=";odata=verbose"):(r=a.listItem.__metadata.uri,d["X-HTTP-Method"]="MERGE",d["If-Match"]=a.listItem.__metadata.etag);var m=$.ajax({url:r,type:"POST",processData:!1,contentType:p,data:JSON.stringify(u),headers:d});m.done(function(t){a.listItem=e.Utils.clone(t.d),a.itemId=a.listItem.Id,o&&!a.debug?(a.showDialog("<p>Your form has been submitted. You will be redirected in "+l/1e3+" seconds.</p>","Form Submission Successful"),setTimeout(function(){window.location.href=null!=a.sourceUrl?a.sourceUrl:a.confirmationUrl},l)):((s||i)&&(c+="<p>This page will refresh in "+l/1e3+" seconds.</p>"),a.showDialog(c,"The form has been saved.",l),s||i?setTimeout(function(){window.location.search="?formid="+a.itemId},l):(a.bindListItemValues(a),setTimeout(function(){a.getHistoryAsync(a)},5e3)))}),m.fail(function(e){var t=e.statusText+". An error occurred while saving the form.";a.showDialog(t),a.logError(t+": "+JSON.stringify(arguments))})}},t.prototype.getAttachmentsAsync=function(t,o){if(void 0===t&&(t=void 0),void 0===o&&(o=void 0),t=t||this,!t.listItem||!t.enableAttachments)return void t.nextAsync(!0);try{t.getListItemsRest(t.listItem.Attachments.__deferred.uri,function(o){$.each(o.d.results,function(o,i){t.viewModel.attachments().push(new e.Attachment(i))}),t.nextAsync(!0,"Retrieved attachments.")})}catch(i){t.debug&&console.warn(i)}},t.prototype.deleteAttachment=function(e){var t=this,o=t.viewModel;try{var i='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><DeleteAttachment xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+t.listName+"</listName><listItemID>"+t.itemId+"</listItemID><url>"+e.href+"</url></DeleteAttachment></soap:Body></soap:Envelope>",n=$.ajax({url:t.rootUrl+t.siteUrl+"/_vti_bin/lists.asmx",type:"POST",dataType:"xml",data:i,contentType:"text/xml; charset='utf-8'",headers:{SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/DeleteAttachment","Content-Type":"text/xml; charset=utf-8"}});n.done(function(){var t=o.attachments;t.remove(e)}),n.fail(function(e,o){var i="Failed to delete attachment: "+o;t.logError(i)})}catch(r){t.logError(r)}},t.prototype.getListItemsSoap=function(e,t,o,i,n,r,a,s){void 0===r&&(r=25),void 0===a&&(a="<ViewName/>"),void 0===s&&(s="<QueryOptions/>");var l=this;try{var c='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+t+"</listName><query>"+i+"</query><viewFields>"+o+"</viewFields><rowLimit>"+r+"</rowLimit></GetListItems></soap:Body></soap:Envelope>",u=$.ajax({url:e+"/_vti_bin/lists.asmx",type:"POST",dataType:"xml",data:c,headers:{SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetListItems","Content-Type":"text/xml; charset=utf-8"}});u.done(n),u.fail(function(e){l.logError("<pre>"+e+"</pre>")})}catch(d){l.logError(d)}},t.prototype.getListAsync=function(e,t){void 0===t&&(t=void 0);var o='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetList xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>{0}</listName></GetList></soap:Body></soap:Envelope>',i=$.ajax({url:e.rootUrl+e.siteUrl+"/_vti_bin/lists.asmx",type:"POST",cache:!1,dataType:"xml",data:o.replace("{0}",e.listName),headers:{SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetList","Content-Type":"text/xml; charset=utf-8"}});i.done(function(t){var o=$(t).find("List").first();e.listId=o.attr("ID"),e.requireCheckout="true"==o.attr("RequireCheckout").toLowerCase(),e.enableAttachments="true"==o.attr("EnableAttachments").toLowerCase(),e.defaultViewUrl=o.attr("DefaultViewUrl"),e.defailtMobileViewUrl=o.attr("MobileDefaultViewUrl"),e.nextAsync(!0)}),i.fail(function(){e.nextAsync(!1,"Failed to retrieve list data.")})},t.prototype.log=function(e){this.debug&&console.log(e)},t.prototype.updateStatus=function(e,t){void 0===t&&(t=void 0),t=t||!0,this.$formStatus.html(e).css("color",t?"#ff0":"$f00").slideUp()},t.prototype.showDialog=function(e,t,o){void 0===t&&(t=void 0),void 0===o&&(o=void 0);var i=this;t=t||"Form Dialog",e=null==e.toString().match(/<\w>\w*/)?"<p>"+e+"</p>":e,i.$dialog.html(e).dialog("open"),o&&setTimeout(function(){i.$dialog.dialog.close()},o)},t.prototype.getListItemsRest=function(e,t,o,i){void 0===o&&(o=void 0),void 0===i&&(i=void 0);var n=this,r=$.ajax({url:e,type:"GET",cache:!1,dataType:"json",contentType:"application/json; charset=utf-8",headers:{Accept:"application/json"}});r.done(t);var o=o||function(e,t,o){if(e.status&&"404"==e.status)var i=e.statusText+". The data may have been deleted by another user.";else i=t+" "+o;n.showDialog(i)};r.fail(o),i&&r.always(i)},t.prototype.formIsValid=function(t,o){void 0===o&&(o=!1);var i=t.parent,n=[],r=0,a=0,s=[];try{return i.$form.find(".required, [required]").each(function(o,i){var a=e.Utils.observableNameFromControl(i);if(a&&t[a]){var s=t[a]();if(null==s){var l=$(i).parent().find("label:first").html();l||$(i).parent().first().html(),n.indexOf(l)<0&&(n.push(l),r++)}}}),i.$form.find(".invalid").each(function(e,t){$(t).parent();s.push($(parent).first().html()),a++}),a>0&&n.push('<p class="warning">There are validation errors with the following fields. Please correct before saving.</p><p style="color:#f00;">'+s.join("<br />")+"</p>"),i.enableAttachments&&i.requireAttachments&&0==t.attachments().length&&(r++,n.push(i.attachmentMessage)),r>0?(o&&i.showDialog('<p class="warning">The following are required:</p><p class="error"><strong>'+n.join("<br/>")+"</strong></p>"),!1):!0}catch(l){return i.logError("Form validation error at formIsValid(): "+JSON.stringify(l)),!1}},t.prototype.logError=function(t,o){void 0===o&&(o=void 0),o=o||this,o.showDialog("<p>An error has occurred and the web administrator has been notified.</p><p>Error Details: <pre>"+t+"</pre></p>"),o.enableErrorLog&&e.Utils.logError(t,o.errorLogListName,o.rootUrl,o.debug)},t}();e.SPForm=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function e(e,t){this.description=e,this.date=t}return e}();e.HistoryItem=t;var o=function(){function e(e){this.title=e.name,this.href=e.__metadata.media_src,this.ext=null!=e.name.match(/./)?e.name.substring(e.name.lastIndexOf(".")+1,e.name.length):""}return e}();e.Attachment=o;var i=function(){function e(){}return e}();e.SpItem=i}(Shockout||(Shockout={}));var Shockout;!function(Shockout){Shockout.qq=Shockout.qq||{},Shockout.qq.extend=function(e,t){for(var o in t)e[o]=t[o]},Shockout.qq.indexOf=function(e,t,o){if(e.indexOf)return e.indexOf(t,o);o=o||0;var i=e.length;for(0>o&&(o+=i);i>o;o++)if(o in e&&e[o]===t)return o;return-1},Shockout.qq.getUniqueId=function(){var e=0;return function(){return e++}}(),Shockout.qq.attach=function(e,t,o){e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&e.attachEvent("on"+t,o)},Shockout.qq.detach=function(e,t,o){e.removeEventListener?e.removeEventListener(t,o,!1):e.attachEvent&&e.detachEvent("on"+t,o)},Shockout.qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},Shockout.qq.insertBefore=function(e,t){t.parentNode.insertBefore(e,t)},Shockout.qq.remove=function(e){e.parentNode.removeChild(e)},Shockout.qq.contains=function(e,t){return e==t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e))},Shockout.qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var o=e.firstChild;return e.removeChild(o),o}}(),Shockout.qq.css=function(e,t){null!=t.opacity&&"string"!=typeof e.style.opacity&&"undefined"!=typeof e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),Shockout.qq.extend(e.style,t)},Shockout.qq.hasClass=function(e,t){var o=new RegExp("(^| )"+t+"( |$)");return o.test(e.className)},Shockout.qq.addClass=function(e,t){Shockout.qq.hasClass(e,t)||(e.className+=" "+t)},Shockout.qq.removeClass=function(e,t){var o=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(o," ").replace(/^\s+|\s+$/g,"")},Shockout.qq.setText=function(e,t){e.innerText=t,e.textContent=t},Shockout.qq.children=function(e){for(var t=[],o=e.firstChild;o;)1==o.nodeType&&t.push(o),o=o.nextSibling;return t},Shockout.qq.getByClass=function(e,t){if(e.querySelectorAll)return e.querySelectorAll("."+t);for(var o=[],i=e.getElementsByTagName("*"),n=i.length,r=0;n>r;r++)Shockout.qq.hasClass(i[r],t)&&o.push(i[r]);return o},Shockout.qq.obj2url=function(e,t,o){var i=[],n="&",r=function(e,o){var n=t?/\[\]$/.test(t)?t:t+"["+o+"]":o;"undefined"!=n&&"undefined"!=o&&i.push("object"==typeof e?Shockout.qq.obj2url(e,n,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(n)+"="+encodeURIComponent(e()):encodeURIComponent(n)+"="+encodeURIComponent(e))};if(!o&&t)n=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",i.push(t),i.push(Shockout.qq.obj2url(e));else if("[object Array]"===Object.prototype.toString.call(e)&&"undefined"!=typeof e)for(var a=0,s=e.length;s>a;++a)r(e[a],a);else if("undefined"!=typeof e&&null!==e&&"object"==typeof e)for(var l in e)r(e[l],l);else i.push(encodeURIComponent(t)+"="+encodeURIComponent(e));return i.join(n).replace(/^&/,"").replace(/%20/g,"+")},Shockout.qq.FileUploaderBasic=function(e){this._options={debug:!1,action:"/server/upload",params:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(e){alert(e)}},Shockout.qq.extend(this._options,e),this._filesInProgress=0,this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},Shockout.qq.FileUploaderBasic.prototype={setParams:function(e){this._options.params=e},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(e){var t=this;return new Shockout.qq.UploadButton({element:e,multiple:this._options.multiple&&Shockout.qq.UploadHandlerXhr.isSupported(),onChange:function(e){t._onInputChange(e)}})},_createUploadHandler:function(){var e,t=this;e=Shockout.qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm";var o=new Shockout.qq[e]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(e,o,i,n){t._onProgress(e,o,i,n),t._options.onProgress(e,o,i,n)},onComplete:function(e,o,i){t._onComplete(e,o,i),t._options.onComplete(e,o,i)},onCancel:function(e,o){t._onCancel(e,o),t._options.onCancel(e,o)}});return o},_preventLeaveInProgress:function(){var e=this;Shockout.qq.attach(window,"beforeunload",function(t){if(e._filesInProgress){var t=t||window.event;return t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave}})},_onSubmit:function(){this._filesInProgress++},_onProgress:function(){},_onComplete:function(e,t,o){this._filesInProgress--,o.error&&this._options.showMessage(o.error)},_onCancel:function(){this._filesInProgress--},_onInputChange:function(e){this._handler instanceof Shockout.qq.UploadHandlerXhr?this._uploadFileList(e.files):this._validateFile(e)&&this._uploadFile(e),this._button.reset()},_uploadFileList:function(e){for(var t=0;t<e.length;t++)if(!this._validateFile(e[t]))return;for(var t=0;t<e.length;t++)this._uploadFile(e[t])},_uploadFile:function(e){var t=this._handler.add(e),o=this._handler.getName(t);this._options.onSubmit(t,o)!==!1&&(this._onSubmit(t,o),this._handler.upload(t,this._options.params))},_validateFile:function(e){var t,o;return e.value?t=e.value.replace(/.*(\/|\\)/,""):(t=null!=e.fileName?e.fileName:e.name,o=null!=e.fileSize?e.fileSize:e.size),this._isAllowedExtension(t)?0===o?(this._error("emptyError",t),!1):o&&this._options.sizeLimit&&o>this._options.sizeLimit?(this._error("sizeError",t),!1):o&&o<this._options.minSizeLimit?(this._error("minSizeError",t),!1):!0:(this._error("typeError",t),!1)},_error:function(e,t){function o(e,t){i=i.replace(e,t)}var i=this._options.messages[e];o("{file}",this._formatFileName(t)),o("{extensions}",this._options.allowedExtensions.join(", ")),o("{sizeLimit}",this._formatSize(this._options.sizeLimit)),o("{minSizeLimit}",this._formatSize(this._options.minSizeLimit)),this._options.showMessage(i)},_formatFileName:function(e){return e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-13)),e},_isAllowedExtension:function(e){var t=-1!==e.indexOf(".")?e.replace(/.*[.]/,"").toLowerCase():"",o=this._options.allowedExtensions;if(!o.length)return!0;for(var i=0;i<o.length;i++)if(o[i].toLowerCase()==t)return!0;return!1},_formatSize:function(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][t]}},Shockout.qq.FileUploader=function(e){Shockout.qq.FileUploaderBasic.apply(this,arguments),Shockout.qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Attach File</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}}),Shockout.qq.extend(this._options,e),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),this._bindCancelEvent(),this._setupDragDrop()},Shockout.qq.extend(Shockout.qq.FileUploader.prototype,Shockout.qq.FileUploaderBasic.prototype),Shockout.qq.extend(Shockout.qq.FileUploader.prototype,{_find:function(e,t){var o=Shockout.qq.getByClass(e,this._options.classes[t])[0];if(!o)throw new Error("element not found "+t);return o},_setupDragDrop:function(){var e=this,t=this._find(this._element,"drop"),o=new Shockout.qq.UploadDropZone({element:t,onEnter:function(o){Shockout.qq.addClass(t,e._classes.dropActive),o.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(){Shockout.qq.removeClass(t,e._classes.dropActive)},onDrop:function(o){t.style.display="none",Shockout.qq.removeClass(t,e._classes.dropActive),e._uploadFileList(o.dataTransfer.files)}});t.style.display="none",Shockout.qq.attach(document,"dragenter",function(e){o._isValidFileDrag(e)&&(t.style.display="block")}),Shockout.qq.attach(document,"dragleave",function(e){if(o._isValidFileDrag(e)){var i=document.elementFromPoint(e.clientX,e.clientY);i&&"HTML"!=i.nodeName||(t.style.display="none")}})},_onSubmit:function(e,t){Shockout.qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onProgress:function(e,t,o,i){Shockout.qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var n=this._getItemByFileId(e),r=this._find(n,"size");r.style.display="inline";var a;a=o!=i?Math.round(o/i*100)+"% from "+this._formatSize(i):this._formatSize(i),Shockout.qq.setText(r,a)},_onComplete:function(e,t,o){Shockout.qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var i=this._getItemByFileId(e);Shockout.qq.remove(this._find(i,"cancel")),Shockout.qq.remove(this._find(i,"spinner")),o.success?Shockout.qq.addClass(i,this._classes.success):Shockout.qq.addClass(i,this._classes.fail)},_addToList:function(e,t){var o=Shockout.qq.toElement(this._options.fileTemplate);o.qqFileId=e;var i=this._find(o,"file");Shockout.qq.setText(i,this._formatFileName(t)),this._find(o,"size").style.display="none",this._listElement.appendChild(o)},_getItemByFileId:function(e){for(var t=this._listElement.firstChild;t;){if(t.qqFileId==e)return t;t=t.nextSibling}},_bindCancelEvent:function(){var e=this,t=this._listElement;Shockout.qq.attach(t,"click",function(t){t=t||window.event;var o=t.target||t.srcElement;if(Shockout.qq.hasClass(o,e._classes.cancel)){Shockout.qq.preventDefault(t);var i=o.parentNode;e._handler.cancel(i.qqFileId),Shockout.qq.remove(i)}})}}),Shockout.qq.UploadDropZone=function(e){this._options={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},Shockout.qq.extend(this._options,e),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},Shockout.qq.UploadDropZone.prototype={_disableDropOutside:function(){Shockout.qq.UploadDropZone.dropOutsideDisabled||(Shockout.qq.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),Shockout.qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var e=this;Shockout.qq.attach(e._element,"dragover",function(t){if(e._isValidFileDrag(t)){var o=t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"==o||"linkMove"==o?"move":"copy",t.stopPropagation(),t.preventDefault()}}),Shockout.qq.attach(e._element,"dragenter",function(t){e._isValidFileDrag(t)&&e._options.onEnter(t)}),Shockout.qq.attach(e._element,"dragleave",function(t){if(e._isValidFileDrag(t)){e._options.onLeave(t);var o=document.elementFromPoint(t.clientX,t.clientY);Shockout.qq.contains(this,o)||e._options.onLeaveNotDescendants(t)}}),Shockout.qq.attach(e._element,"drop",function(t){e._isValidFileDrag(t)&&(t.preventDefault(),e._options.onDrop(t))})},_isValidFileDrag:function(e){var t=e.dataTransfer,o=navigator.userAgent.indexOf("AppleWebKit")>-1;return t&&"none"!=t.effectAllowed&&(t.files||!o&&t.types.contains&&t.types.contains("Files"))}},Shockout.qq.UploadButton=function(e){this._options={element:null,multiple:!1,name:"file",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},Shockout.qq.extend(this._options,e),this._element=this._options.element,Shockout.qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},Shockout.qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&Shockout.qq.remove(this._input),Shockout.qq.removeClass(this._element,this._options.focusClass),this._input=this._createInput()},_createInput:function(){var e=document.createElement("input");this._options.multiple&&e.setAttribute("multiple","multiple"),e.setAttribute("type","file"),e.setAttribute("name",this._options.name),Shockout.qq.css(e,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(e);var t=this;return Shockout.qq.attach(e,"change",function(){t._options.onChange(e)}),Shockout.qq.attach(e,"mouseover",function(){Shockout.qq.addClass(t._element,t._options.hoverClass)}),Shockout.qq.attach(e,"mouseout",function(){Shockout.qq.removeClass(t._element,t._options.hoverClass)}),Shockout.qq.attach(e,"focus",function(){Shockout.qq.addClass(t._element,t._options.focusClass)}),Shockout.qq.attach(e,"blur",function(){Shockout.qq.removeClass(t._element,t._options.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}},Shockout.qq.UploadHandlerAbstract=function(e){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(){},onComplete:function(){},onCancel:function(){}},Shockout.qq.extend(this._options,e),this._queue=[],this._params=[]
},Shockout.qq.UploadHandlerAbstract.prototype={log:function(e){this._options.debug&&window.console&&console.log("[uploader] "+e)},add:function(){},upload:function(e,t){var o=this._queue.push(e),i={};Shockout.qq.extend(i,t),this._params[e]=i,o<=this._options.maxConnections&&this._upload(e,this._params[e])},cancel:function(e){this._cancel(e),this._dequeue(e)},cancelAll:function(){for(var e=0;e<this._queue.length;e++)this._cancel(this._queue[e]);this._queue=[]},getName:function(){},getSize:function(){},getQueue:function(){return this._queue},_upload:function(){},_cancel:function(){},_dequeue:function(e){var t=Shockout.qq.indexOf(this._queue,e);this._queue.splice(t,1);var o=this._options.maxConnections;if(this._queue.length>=o){var i=this._queue[o-1];this._upload(i,this._params[i])}}},Shockout.qq.UploadHandlerForm=function(){Shockout.qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={}},Shockout.qq.extend(Shockout.qq.UploadHandlerForm.prototype,Shockout.qq.UploadHandlerAbstract.prototype),Shockout.qq.extend(Shockout.qq.UploadHandlerForm.prototype,{add:function(e){e.setAttribute("name","qqfile");var t="qq-upload-handler-iframe"+Shockout.qq.getUniqueId();return this._inputs[t]=e,e.parentNode&&Shockout.qq.remove(e),t},getName:function(e){return this._inputs[e].value.replace(/.*(\/|\\)/,"")},_cancel:function(e){this._options.onCancel(e,this.getName(e)),delete this._inputs[e];var t=document.getElementById(e);t&&(t.setAttribute("src","javascript:false;"),Shockout.qq.remove(t))},_upload:function(e,t){var o=this._inputs[e];if(!o)throw new Error("file with passed id was not added, or already uploaded or cancelled");var i=this.getName(e),n=this._createIframe(e),r=this._createForm(n,t);r.appendChild(o);var a=this;return this._attachLoadEvent(n,function(){a.log("iframe loaded");var t=a._getIframeContentJSON(n);a._options.onComplete(e,i,t),a._dequeue(e),delete a._inputs[e],setTimeout(function(){Shockout.qq.remove(n)},1)}),r.submit(),Shockout.qq.remove(r),e},_attachLoadEvent:function(e,t){Shockout.qq.attach(e,"load",function(){e.parentNode&&(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML||t())})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}return response},_createIframe:function(e){var t=Shockout.qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e,t){var o=Shockout.qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),i=Shockout.qq.obj2url(t,this._options.action);return o.setAttribute("action",i),o.setAttribute("target",e.name),o.style.display="none",document.body.appendChild(o),o}}),Shockout.qq.UploadHandlerXhr=function(){Shockout.qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},Shockout.qq.UploadHandlerXhr.isSupported=function(){var e=document.createElement("input");return e.type="file","multiple"in e&&"undefined"!=typeof File&&"undefined"!=typeof(new XMLHttpRequest).upload},Shockout.qq.extend(Shockout.qq.UploadHandlerXhr.prototype,Shockout.qq.UploadHandlerAbstract.prototype),Shockout.qq.extend(Shockout.qq.UploadHandlerXhr.prototype,{add:function(e){if(!(e instanceof File))throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(e)-1},getName:function(e){var t=this._files[e];return null!=t.fileName?t.fileName:t.name},getSize:function(e){var t=this._files[e];return null!=t.fileSize?t.fileSize:t.size},getLoaded:function(e){return this._loaded[e]||0},_upload:function(e,t){{var o=this._files[e],i=this.getName(e);this.getSize(e)}this._loaded[e]=0;var n=this._xhrs[e]=new XMLHttpRequest,r=this;n.upload.onprogress=function(t){t.lengthComputable&&(r._loaded[e]=t.loaded,r._options.onProgress(e,i,t.loaded,t.total))},n.onreadystatechange=function(){4==n.readyState&&r._onComplete(e,n)},t=t||{},t.qqfile=i;var a=Shockout.qq.obj2url(t,this._options.action);n.open("POST",a,!0),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("X-File-Name",encodeURIComponent(i)),n.setRequestHeader("Content-Type","application/octet-stream"),n.send(o)},_onComplete:function(id,xhr){if(this._files[id]){var name=this.getName(id),size=this.getSize(id);if(this._options.onProgress(id,name,size,size),200==xhr.status){this.log("xhr - server response received"),this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else this._options.onComplete(id,name,{});this._files[id]=null,this._xhrs[id]=null,this._dequeue(id)}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),this._files[e]=null,this._xhrs[e]&&(this._xhrs[e].abort(),this._xhrs[e]=null)}})}(Shockout||(Shockout={}));var Shockout;!function(e){!function(t){t.bindingHandlers.spContentHtml={init:function(e,o,i){function n(){var n=o(),r=e.innerHTML;if(t.isWriteableObservable(n))n(r);else{var a=i();a._ko_property_writers&&a._ko_property_writers.spContentHtml&&a._ko_property_writers.spContentHtml(r)}}$(e).on("blur",n).on("keydown",n).on("change",n).on("mousedown",n)},update:function(e,o){var i=t.utils.unwrapObservable(o())||"";e.innerHTML!==i&&(e.innerHTML=i)}},t.bindingHandlers.spContentEditor={init:function(o,i,n,r){var a=(r.$data,i()),s=(t.unwrap(a),$(o)),l=e.Utils.observableNameFromControl(o);if(l){var c=$("<div>",{"data-bind":"spContentHtml: "+l,"class":"content-editable",contenteditable:!0});s.attr("required")&&!s.hasClass("required")&&(c.attr("required",""),c.addClass("required")),c.insertBefore(s),s.hide()}}},t.bindingHandlers.spPerson={init:function(o,i,n,r){function a(t,o){var i=$.trim($(t).val());return""==i?(o(null),void $(t).removeClass("valid").removeClass("invalid")):void(e.Utils.validateSpPerson(o())?($(t).val(o().split("#")[1]),$(t).addClass("valid").removeClass("invalid")):$(t).removeClass("valid").addClass("invalid"))}try{if("input"!=o.tagName.toLowerCase()||"hidden"==$(o).attr("type"))return;{var s=(r.$data,i());t.unwrap(s)}$(o).attr("placeholder","Employee Account Name").addClass("people-picker-control");var l=$(o).parent(),c=$("<button>",{html:"<span>Validate</span>","class":"sp-validate-person",title:"Validate the employee account name."}).on("click",function(){return""==$.trim($(o).val())?($(o).removeClass("invalid").removeClass("valid"),!1):(e.Utils.validateSpPerson(s())?(u.text("Valid").removeClass("error"),$(o).removeClass("invalid").addClass("valid")):(u.text("Invalid").addClass("error"),$(o).addClass("invalid").removeClass("valid")),!1)});l.append(c);var u=$("<span>",{"class":"sp-validation person"});l.append(u);var d=$("<div>",{"class":"no-print",html:"<em>Enter the employee name. The auto-suggest menu will appear below the field. Select the account name.</em>"});l.append(d),$(o).autocomplete({source:function(t,o){e.Utils.peopleSearch(t.term,function(e){o($.map(e,function(e){return{label:e.Name+" ("+e.WorkEMail+")",value:e.Id+";#"+e.Account}}))})},minLength:3,select:function(e,t){s(t.item.value)}}).on("focus",function(){$(this).removeClass("valid")}).on("blur",function(){a(this,s)}).on("mouseout",function(){a(this,s)})}catch(p){var h="Error in Knockout handler spPerson init(): "+JSON.stringify(p);throw e.Utils.logError(h,e.SPForm.errorLogListName),h}},update:function(o,i,n,r){try{var a=(r.$data,i()),s=t.unwrap(a),l="";e.Utils.validateSpPerson(s)&&(l=s.split("#")[1],$(o).addClass("valid")),"value"in o?$(o).val(l):$(o).text(l)}catch(c){var u="Error in Knockout handler spPerson update(): "+JSON.stringify(c);throw e.Utils.logError(u,e.SPForm.errorLogListName),u}}},t.bindingHandlers.spDate={init:function(e,t){function o(){try{if(""==$.trim(this.value))return void i(null);i(new Date(this.value))}catch(e){i(null),this.value=""}}var i=t();"input"==e.tagName.toLowerCase()&&"hidden"!=$(e).attr("type")&&($(e).datepicker().addClass("datepicker med").on("blur",o).on("change",o),$(e).attr("placeholder","MM/DD/YYYY"))},update:function(o,i,n,r){var a=(r.$data,i()),s=t.unwrap(a),l="";if(s&&null!=s){var c=new Date(s);l=e.Utils.dateToLocaleString(c)}"value"in o?$(o).val(l):$(o).text(l)}},t.bindingHandlers.spDateTime={init:function(o,i,n,r){if("input"==o.tagName.toLowerCase()&&"hidden"!=$(o).attr("type")){var a,s,l,c,u=(r.$data,i()),d=(t.unwrap(u),$(o));try{l=$("<span>",{"class":"no-print"}).insertAfter(d),c=$("<span>",{"class":"error",html:"Invalid Date-time",style:"display:none;"}).insertAfter(d),o.$display=l,o.$error=c,a=d.hasClass("required")||null!=d.attr("required"),d.attr({placeholder:"MM/DD/YYYY",maxlength:10,"class":"datepicker med"}).datepicker().on("change",function(){try{if(c.hide(),!e.Utils.isDate(this.value))return void c.show();var t=this.value;t=t.split("/");var o=t[0]-1,i=t[1]-0,n=t[2]-0,r=null==u()?new Date(n,o,i):u();r.setMonth(o),r.setDate(i),r.setYear(n),u(r),l.html(e.Utils.toDateTimeLocaleString(r))}catch(a){c.show()}}),s=$("<input>",{type:"text",maxlength:8,style:"width:6em;","class":a?"required":"",placeholder:"HH:MM PM"}).insertAfter(d).on("change",function(){try{c.hide();var t=this.value.toString().toUpperCase().replace(/[^\d\:AMP\s]/g,"");if(this.value=t,null==u())return;if(!e.Utils.isTime(t))return void c.show();var o=u(),i=t.replace(/[^AMP]/g,""),n=t.replace(/[^\d\:]/g,"").split(":"),r=n[0]-0,a=n[1]-0;"PM"==i&&12>r?r+=12:"AM"==i&&12==r&&(r=0),o.setHours(r),o.setMinutes(a),u(o),l.html(e.Utils.toDateTimeLocaleString(o)),c.hide()}catch(s){l.html(s),c.show()}}),s.before("<span> Time: </span>").after('<span class="no-print"> (HH:MM PM) </span>'),o.$time=s,null==u()&&(d.val(""),s.val(""))}catch(p){var h="Error in Knockout handler spDateTime init(): "+JSON.stringify(p);e.Utils.logError(h,e.SPForm.errorLogListName)}}},update:function(o,i,n,r){var a=(r.$data,i()),s=t.unwrap(a);try{if(s&&null!=s){var l=new Date(s),c=e.Utils.dateToLocaleString(l),u=e.Utils.toTimeLocaleString(l);"input"==o.tagName.toLowerCase()?(o.value=c,o.$time.val(u),o.$display.html(c+" "+u)):o.innerHTML=c+" "+u}}catch(d){var p="Error in Knockout handler spDateTime update(): "+JSON.stringify(d);e.Utils.logError(p,e.SPForm.errorLogListName)}}},t.bindingHandlers.spMoney={init:function(e,o,i,n,r){function a(){var e=this.value.toString().replace(/[^\d\.\-]/g,"");e=""==e?null:e-0,s(e)}if("input"==e.tagName.toLowerCase()&&"hidden"!=$(e).attr("type")){n=r.$data;{var s=o();t.unwrap(s)}$(e).on("blur",a).on("change",a)}},update:function(o,i,n,r,a){r=a.$data;var s=i(),l=t.unwrap(s);null!=l?0>l?$(o).addClass("negative"):$(o).removeClass("negative"):l=0;var c=e.Utils.formatMoney(l);e.Utils.updateKoField(o,c)}},t.bindingHandlers.spDecimal={init:function(e,o,i,n,r){function a(){var e=this.value.toString().replace(/[^\d\-\.]/g,"");e=""==e?null:e-0,s(e)}if("input"==e.tagName.toLowerCase()&&"hidden"!=$(e).attr("type")){n=r.$data;{var s=o();t.unwrap(s)}$(e).on("blur",a).on("change",a)}},update:function(o,i,n,r,a){r=a.$data;var s=i(),l=t.unwrap(s),c=n.get("precision")||2,u=e.Utils.toFixed(l,c);null!=l?0>l?$(o).addClass("negative"):$(o).removeClass("negative"):l=0,e.Utils.updateKoField(o,u)}},t.bindingHandlers.spNumber={init:function(e,o,i,n,r){function a(){var e=this.value.toString().replace(/[^\d\-]/g,"");e=""==e?null:e-0,s(e)}if("input"==e.tagName.toLowerCase()&&"hidden"!=$(e).attr("type")){n=r.$data;{var s=o();t.unwrap(s)}$(e).on("blur",a).on("change",a)}},update:function(o,i,n,r,a){r=a.$data;var s=i(),l=t.unwrap(s);l=null==l?0:l,l=l.constructor==String?l=l.replace(/\D/g)-0:l,e.Utils.updateKoField(o,l),s.constructor==Function&&s(l)}}}(ko)}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function t(){}return t.getFileUploadTemplate=function(){return'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="btn qq-upload-button">Attach Files</div><ul class="qq-upload-list"></ul></div>'},t.getCreatedModifiedInfo=function(){var t='<h4>Created/Modified Information</h4><ul><li class="create-mod-info no-print"></li><li><label>Created By</label><a data-bind="text: {0}, attr:{href: \'mailto:\'+{1}()}" class="email"></a></li><li><label>Created</label><span data-bind="spDateTime: {2}"></span></li><li><label>Modified By</label><a data-bind="text: {3}, attr:{href: \'mailto:\'+{4}()}" class="email"></a></li><li><label>Modified</label><span data-bind="spDateTime: {5}"></span></li></ul>',o=document.createElement("section");return o.className="created-mod-info",o.innerHTML=t.replace(/\{0\}/g,e.ViewModel.createdByKey).replace(/\{1\}/g,e.ViewModel.createdByEmailKey).replace(/\{2\}/g,e.ViewModel.createdKey).replace(/\{3\}/g,e.ViewModel.modifiedByKey).replace(/\{4\}/g,e.ViewModel.modifiedByEmailKey).replace(/\{5\}/g,e.ViewModel.modifiedKey),o},t.getHistoryTemplate=function(){var t='<h4>Workflow History</h4><table border="1" cellpadding="5" cellspacing="0" class="data-table" style="width:100%;border-collapse:collapse;"><thead><tr><th>Description</th><th>Date</th></tr></thead><tbody data-bind="foreach: {0}"><tr><td data-bind="text: {1}"></td><td data-bind="text: {2}"></td></tr></tbody></table>',o=document.createElement("section");return o.setAttribute("data-bind","visible: {0}.length > 0".replace(/\{0\}/i,e.ViewModel.historyKey)),o.innerHTML=t.replace(/\{0\}/g,e.ViewModel.historyKey).replace(/\{1\}/g,e.ViewModel.historyDescriptionKey).replace(/\{2\}/g,e.ViewModel.historyDateKey),o},t.getFormAction=function(e,t,o){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===o&&(o=!0);var i=[];i.push('<div class="form-breadcrumbs"><a href="/">Home</a> &gt; eForms</div>'),i.push('<button class="btn cancel" data-bind="event: { click: cancel }"><span>Close</span></button>'),o&&i.push('<button class="btn print" data-bind="visible: Id() != null, event: {click: print}"><span>Print</span></button>'),t&&i.push('<button class="btn delete" data-bind="visible: Id() != null, event: {click: deleteItem}"><span>Delete</span></button>'),e&&i.push('<button class="btn save" data-bind="event: { click: save }"><span>Save</span></button>'),i.push('<button class="btn submit" data-bind="event: { click: submit }, visible: isValid"><span>Submit</span></button>');var n=document.createElement("div");return n.className="form-action",n.innerHTML=i.join(""),n},t.getAttachmentsTemplate=function(e){var t='<h4>Attachments</h4><div id="{0}"></div><table class="attachments-table"><tbody data-bind="foreach: attachments"><tr><td><a href="" data-bind="text: title, attr: {href: href, \'class\': ext}"></a></td><td><button data-bind="event: {click: $root.deleteAttachment}" class="btn del" title="Delete"><span>Delete</span></button></td></tr></tbody></table>',o=document.createElement("div");return o.innerHTML=t.replace(/\{0\}/,e),o},t.getUserProfileTemplate=function(e,t){var o='<h4>{header}</h4><img src="{pictureurl}" alt="{name}" /><ul><li><label>Name</label>{name}</li><li><label>Title</label>{jobtitle}</li><li><label>Department</label>{department}</li><li><label>Email</label><a href="mailto:{workemail}">{workemail}</a></li><li><label>Phone</label>{workphone}</li><li><label>Office</label>{office}</li></ul>',i=document.createElement("div");return i.className="user-profile-card",i.innerHTML=o.replace(/\{header\}/g,t).replace(/\{pictureurl\}/g,e.Picture.indexOf(",")>0?e.Picture.split(",")[0]:e.Picture).replace(/\{name\}/g,e.Name||"").replace(/\{jobtitle\}/g,e.Title||"").replace(/\{department\}/g,e.Department||"").replace(/\{workemail\}/g,e.WorkEMail||"").replace(/\{workphone\}/g,e.WorkPhone||"").replace(/\{office\}/g,e.Office||""),i},t}();e.Templates=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function t(){}return t.peopleSearch=function(o,i,n,r){void 0===n&&(n=10),void 0===r&&(r="");var a=n?n.toString():"10",s=r+"/_vti_bin/listdata.svc/UserInformationList?$filter=startswith(Name,'{0}')&$select=Id,Account,Name,WorkEMail&$orderby=Name&$top={1}".replace(/\{0\}/,o).replace(/\{1\}/,a),l=$.ajax({url:s,type:"GET",cache:!1,dataType:"json",contentType:"application/json; charset=utf-8",headers:{Accept:"application/json"}});l.done(function(e){i(e.d.results)}),l.fail(function(o,i,n){var r="People Search error. Status: "+o.statusText+" "+i+" "+JSON.stringify(n);throw t.logError(r,e.SPForm.errorLogListName),r})},t.observableNameFromControl=function(e){var t=$(e).attr("data-bind");if(!t)return null;var o=new RegExp("\\b:(\\s+|)\\w*\\b"),i=o.exec(t),n=i?i[0].replace(/:(\s+|)/gi,""):null;return n},t.parseJsonDate=function(e){return t.isJsonDate(e)?new Date(parseInt(e.replace(/\D/g,""))):null},t.isJsonDate=function(e){return e?/\/Date\(\d+\)\//.test(e+""):!1},t.getQueryParam=function(e){var t=window.escape,o=window.unescape;e=t(o(e));var i=new RegExp("[?&]"+e+"(?:=([^&]*))?","i"),n=i.exec(window.location.search);return null!=n?n[1]:null},t.clone=function(e){if(!(e instanceof Object))return e;var t,o=e.constructor;switch(o){case RegExp:t=new o(e);break;case Date:t=new o(e.getTime());break;default:t=new o}for(var i in e)t[i]=this.clone(e[i]);return t},t.logError=function(e,t,o,i){if(void 0===o&&(o=""),void 0===i&&(i=!1),i)return void console.warn(e);var n=window.location.href,r='<p>An error occurred at <a href="'+n+'" target="_blank">'+n+"</a></p><p>Message: "+e+"</p>";$.ajax({url:o+"/_vti_bin/listdata.svc/"+t.replace(/\s/g,""),type:"POST",processData:!1,contentType:"application/json;odata=verbose",data:JSON.stringify({Title:"Web Form Error",Error:r}),headers:{Accept:"application/json;odata=verbose"},success:function(){},error:function(e){throw e.responseJSON.error}})},t.updateKoField=function(e,t){"input"==e.tagName.toLowerCase()?$(e).val(t):$(e).html(t)},t.validateSpPerson=function(e){return null!=e&&null!=e.toString().match(/^\d*;#/)},t.isTime=function(e){if(!e)return!1;var t=new RegExp("\\d{1,2}:\\d{2}\\s{0,1}(AM|PM)");return t.test(e)},t.isDate=function(e){if(!e)return!1;var t=new RegExp("\\d{1,2}/\\d{1,2}/\\d{4}");return t.test(e.toString())},t.dateToLocaleString=function(e){try{var t=e.getDate();t=10>t?"0"+t:t;var o=e.getMonth()+1;return o=10>o?"0"+o:o,o+"/"+t+"/"+e.getFullYear()}catch(i){return"Invalid Date"}},t.toTimeLocaleObject=function(e){var t,o,i=0;return i=e.getHours(),t=e.getMinutes(),o=i>11?"PM":"AM",10>t&&(t="0"+t),i>12&&(i-=12),{hours:i,minutes:t,tt:o}},t.toTimeLocaleString=function(e){var t=e.getHours(),o=e.getMinutes(),i=t>11?"PM":"AM";return 10>o&&(o="0"+o),t>12?t-=12:0==t&&(t=12),t+":"+o+" "+i},t.toDateTimeLocaleString=function(e){var o=t.toTimeLocaleString(e);return t.dateToLocaleString(e)+" "+o},t.formatMoney=function(e,o,i){void 0===o&&(o="$"),void 0===i&&(i=2);var n=t.unformatNumber(e),r="%s%v",a=r.replace("%v","-%v"),s=n>0?r:0>n?a:r,l=t.formatNumber(Math.abs(n),t.checkPrecision(i));return s.replace("%s",o).replace("%v",l)},t.unformatNumber=function(e){if("number"==typeof e)return e;var t=parseFloat((e+"").replace(/\((.*)\)/,"-$1").replace(/[^0-9-.]/g,""));return isNaN(t)?0:t},t.formatNumber=function(e,o){void 0===o&&(o=0);var i=t.unformatNumber(e),n=t.checkPrecision(o),r=0>i?"-":"",a=parseInt(t.toFixed(Math.abs(i||0),n),10)+"",s=a.length>3?a.length%3:0;return r+(s?a.substr(0,s)+",":"")+a.substr(s).replace(/(\d{3})(?=\d)/g,"$1,")+(n?"."+t.toFixed(Math.abs(i),n).split(".")[1]:"")},t.isString=function(e){return!!(""===e||e&&e.charCodeAt&&e.substr)},t.toFixed=function(e,o){void 0===o&&(o=0),o=t.checkPrecision(o);var i=Math.pow(10,o);return(Math.round(t.unformatNumber(e)*i)/i).toFixed(o)},t.checkPrecision=function(e){return e=Math.round(Math.abs(e)),isNaN(e)?0:e},t}();e.Utils=t}(Shockout||(Shockout={}));var Shockout;!function(e){var t=function(){function e(e){this.CreatedBy=ko.observable(null),this.CreatedByName=ko.observable(null),this.CreatedByEmail=ko.observable(null),this.ModifiedBy=ko.observable(null),this.ModifiedByName=ko.observable(null),this.ModifiedByEmail=ko.observable(null),this.history=ko.observableArray([]),this.attachments=ko.observableArray([]),this.isAuthor=ko.observable(!1),this.currentUser=ko.observable(null);var t=this;this.parent=e,this.isValid=ko.pureComputed(function(){return t.parent.formIsValid(t)})}return e.prototype.deleteItem=function(){this.parent.deleteListItem(this)},e.prototype.cancel=function(){var e=this.parent.getSourceUrl();window.location.href=e?e:this.parent.getRootUrl()},e.prototype.print=function(){window.print()},e.prototype.deleteAttachment=function(e){return this.parent.deleteAttachment(e),!1},e.prototype.save=function(e){this.parent.saveListItem(e,!1)},e.prototype.submit=function(e){this.parent.saveListItem(e,!0)},e.createdByKey="CreatedByName",e.createdByEmailKey="CreatedByEmail",e.modifiedByKey="ModifiedByName",e.modifiedByEmailKey="ModifiedByEmail",e.createdKey="Created",e.modifiedKey="Modified",e.historyKey="history",e.historyDescriptionKey="description",e.historyDateKey="date",e}();e.ViewModel=t}(Shockout||(Shockout={}));